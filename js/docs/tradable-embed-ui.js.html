<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" charset="utf-8">
    <title>tradable-embed 1.2</title>
    <link rel="stylesheet" href="http://getbootstrap.com/2.3.2/assets/css/bootstrap.css">
    <link rel="stylesheet" href="http://getbootstrap.com/2.3.2/assets/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="http://getbootstrap.com/2.3.2/assets/css/docs.css">
    <style>
      body > .navbar .brand {
        float:left;
        text-shadow: rgba(255, 255, 255, 0.0980392) 0px 1px 0px, rgba(255, 255, 255, 0.4) 0px 0px 30px;
        color: white;
        margin-left:0px;
        font-weight:normal;
      }
      
      .bs-docs-sidenav.affix {
        box-shadow: 0 0 20px 1px rgba(0, 0, 0, 0.5);
        z-index: 10;
      }
      
      .bs-docs-sidenav i{
        width: 8px;
        height: 8px;
        padding: 0px;
        margin: 0px;
        display: inline-block;
        margin-right:0.5em;
      }
      
      .bs-docs-sidenav > li > a {
          word-wrap: normal; white-space: nowrap;;
      }
      
      .bs-docs-sidenav > li:first-child > a {
        border-top-right-radius: 6px;
        border-top-left-radius: 6px;
      }
      
      code[class*="language-"],pre[class*="language-"]{color:black;text-shadow:0 1px white;font-family:Consolas,Monaco,'Andale Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*="language-"]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*="language-"],pre[class*="language-"]{background:#f5f2f0}:not(pre)>code[class*="language-"]{padding:.1em;border-radius:.3em}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:slategray}.token.punctuation{color:#999}.namespace{opacity:.7}.token.property,.token.tag,.token.boolean,.token.number{color:#905}.token.selector,.token.attr-name,.token.string{color:#690}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.regex,.token.important{color:#e90}.token.important{font-weight:bold}.token.entity{cursor:help}
      div.description {margin: 14px 0; padding-top: 14px; border-bottom:1px solid #eee; }
      .tags {}
      .ctx-type {
        display:inline-block;
        margin-right:0.5em;
        //- float:right; margin-top:8px
      }
      
      footer iframe{vertical-align:middle;}
      
    .language-javascript {display: none;} .bs-docs-sidenav > li > a {font-size: 12px;}.bs-docs-sidenav > li > a > span {width: 100%;display: inline-block;text-overflow: ellipsis;overflow: hidden;vertical-align: middle;}.alert-success {vertical-align: middle;} .smthingForAccount {display: none !important;} .bs-docs-sidenav > li > a {padding: 0px 15px !important;} .bs-docs-sidenav {margin: 15px 0 0 !important;}#overview {background: #2B3641; }.bs-docs-sidenav > li > a{border: 0; border-bottom: 1px solid #e5e5e5} li {line-height: 17px;}.bs-docs-sidenav i {width: 3px; height:3px}</style>
  </head>
  <body data-spy="scroll" data-target=".scrollspy">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container"><a class="brand">Doxx</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right sponsored"></ul>
          </div>
        </div>
      </div>
    </div>
    <header id="overview" class="jumbotron subhead">
      <div class="container">
        <h1>tradable-embed 1.2</h1>
        <p class="lead"></p>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="span3 bs-docs-sidebar">
          <ul class="nav nav-list bs-docs-sidenav affix-top">
            <li><a href="tradable-embed.js.html">tradable-embed.js</a></li>
            <li class="active"><a href="tradable-embed-ui.js.html">tradable-embed-ui.js</a></li>
          </ul>
          <div class="scrollspy">
            <ul class="nav nav-list bs-docs-sidenav affix-top">
              <li><a href="#promptOrderEntry"><i class="alert alert-info"></i><span>promptOrderEntry</span></a>
              </li>
              <li><a href="#scrapeContent"><i class="alert alert-info"></i><span>scrapeContent</span></a>
              </li>
            </ul>
          </div>
        </div>
        <div class="span9">
          <div class="description"><p>Welcome to the tradable-embed documentation. Tradable Embed is an open API to easily build financial trading features into any app, through any brokerage. This is the documentation for the tradable-embed javascript SDK, which is split into 2 components:</p><ul><li><b>tradable-embed</b>: See <a href='tradable-embed.js.html'>here</a></li><li><b>tradable-embed-ui</b>: Provides Widgets and the website scraper - plug and play! (requires &#39;tradable-embed&#39;)</li></ul>

<p>In order to use tradable-embed-ui include the following scripts in your site (we use jQuery in no coflict mode and we assign it to the variable &#39;trEmbJQ&#39;):</p><p><pre>&lt;script type=&quot;text/javascript&quot; src=&quot;//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js&quot;&gt;&lt;/script&gt;<br />&lt;script type=&quot;text/javascript&quot; src=&quot;//js-api.tradable.com/1.2/tradable-embed.js&quot; id=&quot;tradable-api&quot; data-app-id=&quot;{your_app_id}&quot;&gt;&lt;/script&gt;<br />&lt;script type=&quot;text/javascript&quot; src=&quot;//js-api.tradable.com/1.2/tradable-embed-ui.js&quot;&gt;&lt;/script&gt;</pre><br /><b>NOTE! The oauth flow doesn&#39;t work properly in this documentation site for the codepen examples, for the best experience please see the examples on Codepen.io, you can do that clicking on the &quot;Edit on Codepen&quot; link</b></p> </div>
          <div class="description"><h1>Watch List</h1> </div>
          <h5>Example</h5>
          <p>
            <iframe width="100%" height="300" src="http://codepen.io/tradableEmbed/embed/PPgzpp/?height=200&amp;theme-id=21042&amp;default-tab=html" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
          </p>
          <div class="description"><h1>Portfolio</h1> </div>
          <h5>Example</h5>
          <p>
            <iframe width="100%" height="300" src="http://codepen.io/tradableEmbed/embed/QjPEBB/?height=200&amp;theme-id=21042&amp;default-tab=html" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
          </p>
          <div class="description"><h1>Dashboard</h1> </div>
          <h5>Example</h5>
          <p>
            <iframe width="100%" height="300" src="http://codepen.io/tradableEmbed/embed/epozyx/?height=200&amp;theme-id=21042&amp;default-tab=html" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
          </p>
          <div class="description"><h1>Buttons</h1> </div>
          <pre><code class="language-javascript">**/
		
    var path = getJSPath();

    var scripts = document.getElementsByTagName('script');
	var lastScript = scripts[scripts.length-1];
	var scriptName = lastScript.src;
	var extension = &quot;.css&quot;;
	if(scriptName.indexOf(&quot;min&quot;) !== -1) {
		extension = &quot;.min.css&quot;;
	}

	var elementsToScrape = [&quot;.tr-embed-tradable&quot;];
	
	//Inject all CSS
	injectCSS('robotoFont', '//fonts.googleapis.com/css?family=Roboto:400,500');
	injectCSS('perfectScrollbar', path + 'ext/perfect-scrollbar.min.css');
	injectCSS('tradableEmbedReset', path + 'css/tradable-embed-reset' + extension);
	injectCSS('jQueryUI', path + 'ext/jquery-ui.min.css');
	injectCSS('tradableEmbedMainCSS', path + 'css/tradable-embed' + extension);
	injectCSS('tradableEmbedCSS', path + 'css/tradable-embed-wide' + extension);

	// This will change the css according to the screen width
	adjustStyle($(this).width());
	$(window).resize(function() {
		adjustStyle($(this).width());
	});
	
	// Load Library requirements
	$.when($.getScript(path + &quot;ext/tr-embed-jquery-ui.js&quot;))
	  .done(function( script, textStatus ) {
		console.log('jQuery UI dynamically loaded');
		initializeUI();
	  }).fail(function( jqxhr, settings, exception ) {
		console.error('Error dynamically loading jQuery UI');
	});
	
	///  Extensions to tradableEmbed  ///</code></pre>
          <h5>Example</h5>
          <p>
            <iframe width="100%" height="300" src="http://codepen.io/tradableEmbed/embed/WQWxvE/?height=250&amp;theme-id=21042&amp;default-tab=html" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
          </p>
          <section id="promptOrderEntry">
            <h1>promptOrderEntry</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>tradableEmbed.promptOrderEntry()</span>
            </p>
          </section>
          <table class="table table-bordered table-striped table-condensed">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>symbol(optional)</td>
                <td>String</td>
                <td><p>Instrument symbol or currency to display in the order entry</p></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Opens the order entry light box in the center of the window - This method can be called when trading is not enabled too and an information message will be diplayed.</p> </div>
          <pre><code class="language-javascript">tradableEmbed.promptOrderEntry = function(symbol) {
		$(&quot;#trEmbedUIEnableTradingModal&quot;).append(&quot;&lt;div class='tr-embed tr-embed-modal-overlay'&gt;&lt;/div&gt;&quot;);
		$(&quot;.tr-embed-modal-overlay&quot;).fadeTo(100, 0.7);
	adjustModalLocation();
	if(!tradableEmbed.tradingEnabled) {
			$('#tr-embed-enable-modal').fadeIn(100);
	} else {
		var itemToSet = &quot;&quot;;
		if(!!symbol) {
			itemToSet = symbol.replace(&quot;/&quot;, &quot;&quot;);
		}
		var instrument = tradableEmbed.getInstrumentFromSymbol(itemToSet);
		if(!!instrument) {
			itemToSet = instrument.brokerageAccountSymbol;
		}
			setDisabledState();
			$('#tr-embed-order-entry').fadeIn(100, function() {
				if(!!itemToSet &amp;&amp; itemToSet.length === 3) {
					$(&quot;#instrumentSelector&quot;).focus();
					$(&quot;#instrumentSelector&quot;).catcomplete('search', itemToSet);
				}
			});
			if(!!itemToSet) {
				$(&quot;#instrumentSelector&quot;).val(itemToSet);
				setInstrumentSymbol(itemToSet);
			}
	}
	};

	function executePageScraper() {
		// Clear links
		$('.tr-embed-link-noauth').unbind();
		$('.tr-embed-link-noauth').replaceWith(function() { return this.innerHTML; });
		$('.tr-embed-link').unbind();
		$('.tr-embed-link').replaceWith(function() { return this.innerHTML; });
		$(elementsToScrape).each(function(idx, elem) {
			tradableEmbed.scrapeContent(elem);
		});
	};

	var availableType;
	var availableSymbols = [];
	var baseSymbols = [];</code></pre>
          <section id="scrapeContent">
            <h1>scrapeContent</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>tradableEmbed.scrapeContent()</span>
            </p>
          </section>
          <table class="table table-bordered table-striped table-condensed">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>content</td>
                <td>String</td>
                <td><p>Selector for the content to scrape (for example &#39;.yourClass&#39; or &#39;#yourId&#39;)</p></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Scrapes the content of the given selector and highlights the account instrument symbols and currencies. This can be used when trading is not enabled too and default instruments get highlighted.</p> </div>
          <pre><code class="language-javascript">tradableEmbed.scrapeContent = function(content) {
	if($.inArray(content, elementsToScrape) === -1) {
		elementsToScrape.push(content);
	}
	if(availableSymbols.length === 0 || availableType !== tradableEmbed.tradingEnabled) {
		availableSymbols.splice(0, availableSymbols.length);
		baseSymbols.splice(0, baseSymbols.length);
		initializeAvailableElements();
		availableType = tradableEmbed.tradingEnabled;
	}
    	$(document).ready(function () {
    		$(content).each(function(){
    			var that = this;
    			if(tradableEmbed.tradingEnabled 
    				|| !($(that).hasClass(&quot;tr-embed-pre-scrape-off&quot;))) {

				$(availableSymbols).each(function(index, elem){
					goThroughNodes(that, elem);
				});
				
				$(tradableEmbed.availableCurrencies).each(function(index, elem){
					goThroughNodes(that, elem);
				});
    			}
            });

            if(tradableEmbed.tradingEnabled) {
			$(&quot;.tr-embed-link&quot;).each(function(idx, elem){
				var ev = $._data(this, 'events');
				if(!(ev &amp;&amp; ev.click)) {
					$(elem).on(&quot;click&quot;, function (e) {
						e.preventDefault();
						var symbol = $(this).attr('data-symbol');
						tradableEmbed.promptOrderEntry(symbol);
						trackEvent('Order Entry', {action: &quot;Open&quot;, source: &quot;scraper&quot;, content: symbol});
					});
				}
			});
            } else {
            	$(&quot;.tr-embed-link-noauth&quot;).each(function(idx, elem){
            		var ev = $._data(this, 'events');
				if(!(ev &amp;&amp; ev.click)) {
					$(elem).on(&quot;click&quot;, function (e) {
						e.preventDefault();
						tradableEmbed.promptOrderEntry();
						var symbol = $(this).attr('data-symbol');
						trackEvent('Enable Trading Modal', {action: &quot;Open&quot;, source: &quot;pre scraper&quot;, symbol: symbol});
					});
				}
            	});
            }
    	});
    	function initializeAvailableElements() {
		if(tradableEmbed.tradingEnabled) {
			$(tradableEmbed.availableInstruments).each(function(index, instrument){
				if($.inArray(instrument.symbol, baseSymbols) === -1) {
					baseSymbols.push(instrument.symbol);
				}
				if($.inArray(instrument.brokerageAccountSymbol, baseSymbols) === -1) {
					baseSymbols.push(instrument.brokerageAccountSymbol);
				}
			});
		} else {
			$(symbols).each(function(index, symbol){
				baseSymbols.push(symbol);
			});
		}
		$(baseSymbols).each(function(index, symbol){
			var symbolNoSep = symbol.replace(&quot;/&quot;, &quot;&quot;);
			availableSymbols.push(symbolNoSep);
			if(symbolNoSep.length === 6) {
				var symbolSep = symbolNoSep.substring(0, 3) + &quot;/&quot; + symbolNoSep.substring(3);
				availableSymbols.push(symbolSep);
			}
		});
		try {
			$(Object.keys(symbolNicknames)).each(function(index, nickname){
				if(!tradableEmbed.tradingEnabled 
					|| $.inArray(getSymbolForNickname(nickname), availableSymbols) !== -1) {
					availableSymbols.push(nickname);
				}
			});
		} catch(err) { console.info(&quot;Object.keys not supported, won't find nicknames&quot;) }
    	}
    	var textNode;
        function goThroughNodes(node, item) {
		var next;
		if(!!node &amp;&amp; (!node.classList || !node.classList.contains(&quot;tr-embed-tradable-ignore&quot;))) {
			if (node.nodeType === 1) {
				// (Element node)
				if (node = node.firstChild) {
					do {
						// Recursively call goThroughNodes
						// on each child node
						next = node.nextSibling;
						goThroughNodes(node, item);
					} while(node = next);
				}
			} else if (node.nodeType === 3) {
				// (Text node)
				if (node.parentNode.tagName.toUpperCase() !== &quot;A&quot; &amp;&amp; node.parentNode.tagName.toUpperCase() !== &quot;TEXTAREA&quot;) {
					textNode = node;
					if(!!textNode.data &amp;&amp; textNode.data.replace(/ /g, &quot;&quot;).length &gt; 2) {
						try {
							wrapMatchesInNode(item, textNode);
						} catch(err) {}
					}
				}
			}
		}
	}
	
	function wrapMatchesInNode(textToMatch, textNode) {
		var regexMask = new RegExp(&quot;(?:^|\\s|[\\u0022\\u0023\\u0024\\u007B\\u0027\\u0028\\u0040])&quot;+textToMatch
							+&quot;(?:^|\\s|[\\u002C\\u002E\\u0022\\u0027\\u0029\\u0021\\u003A\\u003B\\u003F\\u007D]|$)&quot;, &quot;ig&quot;);

		if(regexMask.test(textNode.data)) {
			var temp = document.createElement('div');		

			temp.innerHTML = textNode.data.replace(regexMask, function(match, contents, offset, s) {
				var symbol = getSymbolFromTextToMatch(textToMatch);
				var classToAssign = &quot;tr-embed-link&quot;;
				if(!tradableEmbed.tradingEnabled) {
					classToAssign = &quot;tr-embed-link-noauth&quot;;
				}
				var initial = &quot;&quot;;
				var final = &quot;&quot;;
				if(match.match(new RegExp(&quot;(\\s)&quot;+textToMatch, &quot;ig&quot;))) {
					initial = &quot; &quot;;
				} else if(match.match(new RegExp(&quot;([\\u0022\\u0023\\u0024\\u007B\\u0027\\u0028\\u0040])&quot;+textToMatch, &quot;ig&quot;))) {
					initial = match[0];
					match = match.replace(initial, &quot;&quot;);
				}
				if(match.match(new RegExp(textToMatch+&quot;(\\s)&quot;, &quot;ig&quot;))) {
					final = &quot; &quot;;
				} else if(match.match(new RegExp(textToMatch+&quot;([\\u002C\\u002E\\u0022\\u0027\\u0029\\u0021\\u003A\\u003B\\u003F\\u007D])&quot;, &quot;ig&quot;))) {
					final = match[match.length - 1];
					match = match.replace(final, &quot;&quot;);
				}
				return initial + '&lt;a class=&quot;' + classToAssign + '&quot; data-symbol=&quot;' + symbol + '&quot; href=&quot;#&quot; title=&quot;Click to Trade&quot;&gt;'+$.trim(match)+'&lt;/a&gt;' + final;
			});

			// Extract produced nodes and insert them
			// before original textNode:
			if(!!textNode.parentNode) {
				while (temp.firstChild) {
					textNode.parentNode.insertBefore(temp.firstChild, textNode);
				}
				// Remove original text-node:
				textNode.parentNode.removeChild(textNode);
			}
		}
	}
	function getSymbolFromTextToMatch(textToMatch) {
		var symbol = textToMatch.replace(&quot;/&quot;, &quot;&quot;);
		var symForNickname = getSymbolForNickname(textToMatch);
		if(!!symForNickname) {
			symbol = symForNickname;
		}
		if(tradableEmbed.tradingEnabled) {
			if(symbol.length &gt; 3 &amp;&amp; $.inArray(symbol, tradableEmbed.availableSymbols) === -1) {
				var instrument = tradableEmbed.getInstrumentFromBrokerageAccountSymbol(symbol);
				if(!!instrument) {
					symbol = instrument.symbol;
				}
			}
		}
		return symbol;
	}
    };

///  Initialize UI  ///

function initializeUI() {
	console.log('Initializing tradableEmbedUI');

	initializeNotifications();
	
	//setLoading();
	buildEnableTradingModal();
	buildOrderEntryModal();
	initializeTradeButtons();


	tradableEmbed.onEmbedReady(function () {
		console.log(&quot;Initializing Tradable Components... &quot;);
		
		setCurrentModeOnPlaceOrderButton();

		if(tradableEmbed.tradingEnabled) {
			initTracking();
			tradingEnabled();
		} else {
			// Clear links
			$('.tr-embed-link-noauth').replaceWith(function() { return this.innerHTML; });
			$('.tr-embed-link').replaceWith(function() { return this.innerHTML; });
			tradingNotEnabled();
		}
		buildDashboard();
		buildPortfolioWidget();
		buildWatchList();

		executePageScraper();
	});
}

///  Notifications  ///

function initializeNotifications() {
	//add a new style 'tr-embed-notify'
	$.notify.addStyle('tr-embed-notify', {
	  html: 
		&quot;&lt;div class='tr-embed-notify-container'&gt;&quot; 
			+ &quot;&lt;div class='tr-embed-notify-logo'&gt;&quot; 
			+ &quot;&lt;svg viewBox='0 0 35 35' class='tr-embed-notify-container-img'&gt;&quot; 
			+ logo
			+ &quot;&lt;/svg&gt;&lt;/div&gt;&quot; 
			+ &quot;&lt;div class='tr-embed-notify-msg' data-notify-html='msg'/&gt;&quot; +
		&quot;&lt;/div&gt;&quot;
	});

	$.notify.defaults( {
	  // whether to hide the notification on click
	  clickToHide: true,
	  // whether to auto-hide the notification
	  autoHide: true,
	  // if autoHide, hide after milliseconds
	  autoHideDelay: 5000,
	  // show the arrow pointing at the element
	  arrowShow: true,
	  // arrow size in pixels
	  arrowSize: 5,
	  // default positions
	  elementPosition: 'bottom left',
	  globalPosition: 'bottom right',
	  // default style
	  style: 'bootstrap',
	  // default class (string or [string])
	  className: 'error',
	  // show animation
	  showAnimation: 'slideDown',
	  // show animation duration
	  showDuration: 400,
	  // hide animation
	  hideAnimation: 'slideUp',
	  // hide animation duration
	  hideDuration: 200,
	  // padding between element and notification
	  gap: 2
	});
}

///  Trade Buttons  ///

function setLoading() {
	$(document).ready(function() {
		$(&quot;.tr-embed-trade-enable-btn&quot;).text(&quot;&quot;);
		$(&quot;.tr-embed-trade-enable-btn&quot;).append(tradeButtonSvg + &quot;LOADING&quot;);
		$(&quot;.tr-embed-trade-enable-btn&quot;).addClass('tr-embed-trade-enable-btn-loading');
	});
}

function tradingEnabled(){
	$(document).ready(function() {
		trackEvent(&quot;Trading enabled&quot;);
		$(&quot;.tr-embed-trade-enable-btn&quot;).unbind();
		$(&quot;.tr-embed-trade-enable-btn&quot;).text(&quot;&quot;);
		$(&quot;.tr-embed-trade-enable-btn&quot;).append(tradeButtonSvg + &quot;SIGN OUT&quot;);
		$(&quot;.tr-embed-trade-enable-btn&quot;).attr(&quot;href&quot;, &quot;#&quot;);
		$(&quot;.tr-embed-trade-enable-btn&quot;).removeClass('tr-embed-trade-enable-btn-enable');
		$(&quot;.tr-embed-trade-enable-btn&quot;).addClass('tr-embed-trade-enable-btn-logout');
		$(&quot;.tr-embed-trade-enable-btn&quot;).attr(&quot;href&quot;, &quot;#&quot;);
		$('.tr-embed-trade-enable-btn').on(&quot;click&quot;, function (e) {
			e.preventDefault();
			tradableEmbed.signOut();
			trackEvent(&quot;Sign Out&quot;, {source: &quot;Enable trading button&quot;});
		});
		
		// Add widget update listener
		tradableEmbed.onAccountUpdated(function(account) {
			if(!!account) {
				if(dashboardVertical !== undefined) {
					setSnapshotValuesOnDashboard(account);
				}
				if(portfolioVertical !== undefined) {
					initializeOrUpdateRows(account);
				}
				if(watchListVertical !== undefined) {
					updatePricesOnWatchList(account.prices);
				}
			}
		});
	});
}

function tradingNotEnabled(){
        $(document).ready(function() {
        	$(&quot;.tr-embed-trade-enable-btn&quot;).unbind();
        	$(&quot;.tr-embed-trade-enable-btn&quot;).show();
		$(&quot;.tr-embed-trade-enable-btn&quot;).text(&quot;&quot;);
		$(&quot;.tr-embed-trade-enable-btn&quot;).append(tradeButtonSvg + &quot;ENABLE TRADING&quot;);
        	$(&quot;.tr-embed-trade-enable-btn&quot;).attr(&quot;href&quot;, &quot;#&quot;);
		$('.tr-embed-trade-enable-btn').on(&quot;click&quot;, function (e) {
			e.preventDefault();
			tradableEmbed.promptOrderEntry();
			trackEvent('Enable Trading Modal', {action: &quot;Open&quot;, source: &quot;Enable trading button&quot;});
		});
		$(&quot;.tr-embed-trade-enable-btn&quot;).removeClass('tr-embed-trade-enable-btn-logout');
		$(&quot;.tr-embed-trade-enable-btn&quot;).addClass('tr-embed-trade-enable-btn-enable');
		if($(&quot;#tr-embed-dashboard&quot;).length) {
			$(&quot;#tr-embed-dashboard&quot;).empty();
		}
		if($(&quot;#tr-embed-portfolio&quot;).length) {
			$(&quot;#tr-embed-portfolio&quot;).empty();
		}
		if($(&quot;#tr-embed-watch-list&quot;).length) {
			$(&quot;#tr-embed-watch-list&quot;).empty();
		}
        });
        if(!!myQuotesTimer) {
		clearInterval(myQuotesTimer);
		myQuotesTimer = null;
	}
    }

function initializeTradeButtons() {
	$(document).ready(function() {
		$(&quot;.tr-embed-btn&quot;).each(function(idx, item) {
			var text = $(item).text();
			$(item).text(&quot;&quot;);
			$(item).append(tradeButtonSvg + text);
		});
		$(&quot;.tr-embed-trade-action&quot;).attr(&quot;href&quot;, &quot;#&quot;);
		$(&quot;.tr-embed-trade-action&quot;).click(function(e) {
			e.preventDefault();
			var symbol = $(this).attr('data-symbol');
			tradableEmbed.promptOrderEntry(symbol);
			if(tradableEmbed.tradingEnabled) {
				trackEvent('Order Entry', {action: &quot;Open&quot;, source: &quot;Trade Button&quot;});
			} else {
				trackEvent('Enable Trading Modal', {action: &quot;Open&quot;, source: &quot;Trade Button&quot;});
			}
		});
	});
}

///  Enable Trading Modal  ///

function buildEnableTradingModal() {
	$(document).ready(function () {
		$(&quot;body&quot;).append(&quot;&lt;div id='trEmbedUIEnableTradingModal' class='tr-embed'&gt;&lt;/div&gt;&quot;);
		
		$('#trEmbedUIEnableTradingModal').load(path + 'html/enable-trading-modal.html', function() {
			$(&quot;.tr-embed-enable-domain&quot;).text(toTitleCase(location.hostname));
			initializeEnableModal();
		});
	});
}

function initializeEnableModal() {
	$('body').on('click', '.tr-embed-modal-overlay', function() {
		closeEnableModal();
	});

	$('#trEmbedCloseEnableButton').click(function() {
		closeEnableModal();
	});
	
	$(&quot;.tr-embed-enable-modal-button-enable&quot;).click(function() {
		closeEnableModal();
		authenticateWithWindow(&quot;Enable trading modal&quot;);
	});

	$(&quot;.tr-embed-enable-modal-button-cancel&quot;).click(function() {
		closeEnableModal();
	});
}

function closeEnableModal() {
	$(&quot;.tr-embed-enable-modal-box, .tr-embed-modal-overlay&quot;).fadeOut(100, function() {
		$(&quot;.tr-embed-modal-overlay&quot;).remove();
	});
}

///  Dashboard  ///

var dashboardVertical;
function buildDashboard() {
	$(document).ready(function () {
		if($(&quot;#tr-embed-dashboard&quot;).length) {
			dashboardVertical = false;
			var dashboardToLoad = &quot;html/dashboard.html&quot;;
			if($('#tr-embed-dashboard').width() &lt; 425) {
				dashboardToLoad = &quot;html/dashboard-vertical.html&quot;;
				dashboardVertical = true;
			}
			$('#tr-embed-dashboard').addClass(&quot;tr-embed&quot;);
			if(!tradableEmbed.tradingEnabled) {
				return loadOfflineWidget(&quot;dashboard&quot;);
			}
			$('#tr-embed-dashboard').load(path + dashboardToLoad, function() {
				initializeAccountsInSelector(&quot;#trEmbedDashboardAccountsSelect&quot;, &quot;Dashboard&quot;);

				if(dashboardVertical) {
					$(&quot;.tr-embed-account-dashboard-tr-img&quot;).append(tradableVector);
				} else {
					$(&quot;.tr-embed-account-dashboard-td-img&quot;).append(dashboardLogo);
				}
				var text = $(&quot;.tr-embed-account-dashboard-links-pos-ord&quot;).text();
				$(&quot;.tr-embed-account-dashboard-links-pos-ord&quot;).text(&quot;&quot;);
				$(&quot;.tr-embed-account-dashboard-links-pos-ord&quot;).append(posOrdIcon + text);
				text = $(&quot;.tr-embed-account-dashboard-links-trade&quot;).text();
				$(&quot;.tr-embed-account-dashboard-links-trade&quot;).text(&quot;&quot;);
				$(&quot;.tr-embed-account-dashboard-links-trade&quot;).append(tradeIcon + text);
				
				if(!!tradableEmbed.lastSnapshot) {
					setSnapshotValuesOnDashboard(tradableEmbed.lastSnapshot);
				}
				
				$('#tr-embed-dashboard .tr-embed-account-dashboard-links-pos-ord').on(&quot;click&quot;, function () {
				   window.open(&quot;https://web.tradable.com/portfolio&quot;);
				   trackEvent('Dashboard', {action: &quot;Open Positions &amp; Orders&quot;});
				});
				$('#tr-embed-dashboard .tr-embed-account-dashboard-links-trade').on(&quot;click&quot;, function () {
				   if(tradableEmbed.tradingEnabled) {
						tradableEmbed.promptOrderEntry();
						trackEvent('Dashboard', {action: &quot;Open Trade&quot;});
					} else {
						authenticateWithWindow(&quot;Dashboard&quot;);
					}
				});
			});
		}
	});
}

function setSnapshotValuesOnDashboard(account) {
	if(!!account) {
		var profitLoss = getInAccountCurrencyFormat(account.metrics.openProfit);
		var equity = account.metrics.equity;
		if(!!equity) {
			$('#tr-embed-dashboard .tr-embed-account-dashboard-balance').text(prettyPrintNumber(equity.toFixed(2)));
		}
		$('#tr-embed-dashboard .tr-embed-account-dashboard-prof-loss').text(profitLoss);
		if(account.metrics.openProfit &gt;= 0) {
			$('#tr-embed-dashboard .tr-embed-account-dashboard-prof-loss').removeClass('loss');
			$('#tr-embed-dashboard .tr-embed-account-dashboard-prof-loss').addClass('profit');
		} else {
			$('#tr-embed-dashboard .tr-embed-account-dashboard-prof-loss').removeClass('profit');
			$('#tr-embed-dashboard .tr-embed-account-dashboard-prof-loss').addClass('loss');
		}
	}
}

function getInAccountCurrencyFormat(profitLossValue) {
	if(profitLossValue === null || profitLossValue === undefined) {
		return &quot;&quot;;
	}
	var profitLoss = tradableEmbed.selectedAccount.currencySign + prettyPrintNumber(profitLossValue.toFixed(2));
	if(profitLossValue &lt; 0) {
		profitLoss = &quot;-&quot; + profitLoss.replace(&quot;-&quot;, &quot;&quot;);
	} else if(profitLossValue &gt; 0) {
		profitLoss = &quot;+&quot; + profitLoss;
	}
	return profitLoss;
}

//  Offline widgets  //

function loadOfflineWidget(type) {
	if($('#tr-embed-' + type).hasClass(&quot;tr-embed-banner-off&quot;)) {
		return;
	}
	var message = &quot;&lt;p class='tr-embed-offline-widget-description'&gt;You can connect your existing brokerage accounts or simply &quot;
			+ &quot;test out a free practice account and start trading directly from &quot; + location.hostname + &quot;.&lt;/p&gt;&quot;;
	var content = &quot;&lt;h1 class='tr-embed-offline-widget-title'&gt;This could show your &quot; + type.toLowerCase() + &quot;.&lt;/h1&gt;&quot; + message;
	var acc = &quot;&quot;;
	var triggerWidth = 450;
	if(type.toLowerCase() === &quot;dashboard&quot;) {
		acc = &quot;_account&quot;;
		triggerWidth = 420;
		content = message;
		if(!dashboardVertical) {
			content = &quot;&quot;;
		}
	}
	$('#tr-embed-' + type).html(&quot;&lt;div class='tr-embed-offline-widget'&gt;&quot; 
		+ &quot;&lt;div class='bg'&gt;&lt;/div&gt;&quot;
		+ content
		+ &quot;&lt;button type='button' class='tr-embed-trade-large-btn'&gt;Enable Trading&lt;/button&gt;&quot;
		+ &quot;&lt;div class='tr-embed-widget-footer'&gt;Powered by&amp;nbsp;&amp;nbsp;&lt;div class='tr-embed-widget-footer-logo'&gt;&lt;/div&gt;&lt;/div&gt;&quot;
		+ &quot;&lt;/div&gt;&quot;);
	if($('#tr-embed-' + type + &quot; .tr-embed-widget-footer-logo&quot;).is(':empty')) {
		$('#tr-embed-' + type + &quot; .tr-embed-widget-footer-logo&quot;).append(tradableVector);
	}
	
	if($(&quot;.tr-embed-v-&quot; + type).length) {
		$('#tr-embed-' + type + &quot; .tr-embed-offline-widget&quot;).unwrap();
	}
	var bgCss = {
		 &quot;background-size&quot;: &quot;cover&quot;,&quot;background-repeat:&quot;: &quot;no-repeat&quot;,&quot;position&quot;: &quot;absolute&quot;,&quot;z-index&quot;: &quot;-1&quot;,&quot;top&quot;: &quot;0&quot;,
		 &quot;bottom&quot;: &quot;0&quot;,&quot;left&quot;: &quot;0&quot;,&quot;right&quot;: &quot;0&quot;,&quot;opacity&quot;: &quot;.5&quot;,&quot;width&quot;: &quot;100%&quot;,&quot;height&quot;: &quot;100%&quot;
	};
	if((type.toLowerCase() !== &quot;dashboard&quot; &amp;&amp; $('#tr-embed-' + type).width() &lt; triggerWidth) || dashboardVertical) {
		$('#tr-embed-' + type + &quot; .tr-embed-offline-widget&quot;).wrap(&quot;&lt;div class='tr-embed-v-&quot; + type + &quot;'&gt;&lt;/div&gt;&quot;);
		bgCss[&quot;background-image&quot;] = &quot;url(&quot; + path + &quot;css/img/blur&quot; + acc + &quot;_v.png)&quot;;
		$('#tr-embed-' + type + &quot; .tr-embed-offline-widget .bg&quot;).css(bgCss);
	} else {
		bgCss[&quot;background-image&quot;] = &quot;url(&quot; + path + &quot;css/img/blur&quot; + acc + &quot;.png)&quot;;
		$('#tr-embed-' + type + &quot; .tr-embed-offline-widget .bg&quot;).css(bgCss);
	}

	$('#tr-embed-' + type + ' .tr-embed-trade-large-btn').on(&quot;click&quot;, function () {
		tradableEmbed.promptOrderEntry();
		trackEvent('Enable Trading Modal', {action: &quot;Open&quot;, source: toTitleCase(type) + &quot; Enable Button&quot;});
	});
}

///  Positions &amp; Orders  ///

var portfolioVertical;
function buildPortfolioWidget() {
	buildWidget();
}

function buildWidget() {
	$(document).ready(function () {
		// This is for backwards compatibility
		if(!($(&quot;#tr-embed-portfolio&quot;).length)) {
			if($(&quot;#tr-embed-positions&quot;).length &amp;&amp; $(&quot;#tr-embed-orders&quot;).length) {
				$(&quot;#tr-embed-positions&quot;).attr(&quot;id&quot;, &quot;tr-embed-portfolio&quot;);
				$(&quot;#tr-embed-orders&quot;).remove()
			} else if($(&quot;#tr-embed-positions&quot;).length) {
				$(&quot;#tr-embed-positions&quot;).attr(&quot;id&quot;, &quot;tr-embed-portfolio&quot;);
				$('#tr-embed-portfolio').attr(&quot;data-portfolio-type&quot;, &quot;positions&quot;);
			} else if($(&quot;#tr-embed-orders&quot;).length) {
				$(&quot;#tr-embed-orders&quot;).attr(&quot;id&quot;, &quot;tr-embed-portfolio&quot;);
				$('#tr-embed-portfolio').attr(&quot;data-portfolio-type&quot;, &quot;orders&quot;);
			}
		} else {
			if($(&quot;#tr-embed-positions&quot;).length) {
				$(&quot;#tr-embed-positions&quot;).remove();
			}
			if($(&quot;#tr-embed-orders&quot;).length) {
				$(&quot;#tr-embed-orders&quot;).remove();
			}
		}

		if($(&quot;#tr-embed-portfolio&quot;).length) {
			var dataPortfolioType = $('#tr-embed-portfolio').attr(&quot;data-portfolio-type&quot;);
			if (typeof dataPortfolioType === typeof undefined || dataPortfolioType === false) {
				$('#tr-embed-portfolio').attr(&quot;data-portfolio-type&quot;, &quot;positions&quot;);
			}
			var type = $('#tr-embed-portfolio').attr(&quot;data-portfolio-type&quot;);
			$('#tr-embed-portfolio').addClass(&quot;tr-embed&quot;);
			loadWidget(type);
		}
	});
}

function loadWidget(type) {
	portfolioVertical = false;
	var widgetToLoad = &quot;html/&quot; + type + &quot;.html&quot;;
	if($('#tr-embed-portfolio').width() &lt; 450) {
		widgetToLoad = &quot;html/&quot; + type + &quot;-vertical.html&quot;;
		portfolioVertical = true;
	}
	if(!tradableEmbed.tradingEnabled) {
		return loadOfflineWidget(&quot;portfolio&quot;);
	}
	$('#tr-embed-portfolio').load(path + widgetToLoad, function() {
		$(&quot;#tr-embed-portfolio .tr-embed-widget-footer-logo&quot;).append(tradableVector);
		initializeScroll(type);
		initializeAccountsInSelector(&quot;#trEmbed&quot; + toTitleCase(type) + &quot;AccountsSelect&quot;, toTitleCase(type) + &quot; Widget&quot;);
		if(!!tradableEmbed.lastSnapshot) {
			initializeOrUpdateRows(tradableEmbed.lastSnapshot);
		}

		$(&quot;#tr-embed-portfolio .tr-embed-tabs .tr-embed-tab&quot;).each(function(idx, elem){
			var ev = $._data(this, 'events');
			if(!(ev &amp;&amp; ev.click)) {
				$(elem).on(&quot;click&quot;, function (e) {
					e.preventDefault();
					if(!$(this).hasClass(&quot;tr-embed-tab-active&quot;)) {
						var portfolioType = $(&quot;#tr-embed-portfolio .tr-embed-tabs .tr-embed-tab-active&quot;).text();
						$(&quot;#tr-embed-portfolio .tr-embed-tabs .tr-embed-tab-active&quot;).removeClass(&quot;tr-embed-tab-active&quot;);
						$(this).addClass(&quot;tr-embed-tab-active&quot;);
						trackEvent(toTitleCase(type), {action: &quot;Portfolio switch&quot;, source: &quot;Portfolio tab&quot;});
						clearRows();
						loadWidget((portfolioType.toLowerCase() === &quot;positions&quot;) ? &quot;orders&quot; : &quot;positions&quot;);
					}
				});
			}
		});
	});
}

function getCurrentPortfolioType() {
	var portfolioType = $(&quot;#tr-embed-portfolio .tr-embed-tabs .tr-embed-tab-active&quot;).text().toLowerCase();
	return portfolioType;
}

function clearRows() {
	// Clear positions &amp; rows from widgets
	var portfolioType = getCurrentPortfolioType();
	clearRowsOnWidget(portfolioType, portfolioVertical, 
		&quot;.tr-embed-&quot; + portfolioType.substring(0, portfolioType.length-1) + &quot;-row&quot;);
}

function clearRowsOnWidget(type, vertical, rowClass) {
	if($('#tr-embed-portfolio').length) {
		var rowBody = &quot;#trEmbed&quot; + toTitleCase(type) + &quot;Body&quot;;
		if(vertical) {
			rowBody = &quot;#trEmbed&quot; + toTitleCase(type) + &quot;VerticalBody&quot;;
		} 
		$(rowBody + &quot; &quot; + rowClass).each(function (i, row) {
			$(row).empty();
		});
	}
}

function initializeScroll(type) {
	if(!portfolioVertical) {
		$('#trEmbed' + toTitleCase(type) + 'Body').perfectScrollbar();
	} else {
		$('#trEmbed' + toTitleCase(type) + 'VerticalBody').perfectScrollbar();
	}
}

function initializeOrUpdateRows(snapshot) {
	var type = getCurrentPortfolioType();
	var itemType = type.substring(0, type.length - 1);
	var widgetIds = getWidgetRows(type, itemType);
	var currentIds = [];
	var rowElements = (type === &quot;positions&quot;) ? (snapshot.positions.open) : (snapshot.orders.pending);
	$(rowElements).each(function(idx, elem) {
		if($.inArray(elem.id, widgetIds) === -1) {
			addRow(itemType, snapshot, elem);
		} else {
			updateRow(itemType, snapshot, elem);
		}
		currentIds.push(elem.id);
	});
	$(widgetIds).each(function(idx, rowId) {
		if($.inArray(rowId, currentIds) === -1) {
			$(&quot;div[data-&quot; + itemType + &quot;-id='&quot; + rowId + &quot;']&quot;).empty();
		}
	});
	$(&quot;.tr-embed-&quot; + type + &quot;-close&quot;).each(function(idx, elem){
		var ev = $._data(this, 'events');
		if(!(ev &amp;&amp; ev.click)) {
			$(elem).on(&quot;click&quot;, function (e) {
				e.preventDefault();
				var rowId = $(this).closest('.tr-embed-' + itemType + '-row').attr('data-' + itemType + '-id');
				$(this).closest('.tr-embed-' + itemType + '-row').css({opacity: .5});
				if(type === &quot;positions&quot;) {
					executeClosePosition(rowId);
					trackEvent(toTitleCase(type) + ' Widget', {action: &quot;Close &quot; + itemType, positionId: rowId});
				} else {
					executeCancelOrder(rowId);
					trackEvent(toTitleCase(type) + ' Widget', {action: &quot;Close &quot; + itemType, orderId: rowId});
				}
			});
		}
	});
	if(!portfolioVertical) {
		$('#trEmbed' + toTitleCase(type) + 'Body').perfectScrollbar('update');
	} else {
		$('#trEmbed' + toTitleCase(type) + 'VerticalBody').perfectScrollbar('update');
	}
}

function getWidgetRows(type, itemType) {
	var widgetIds = [];
	var tableBodyRows = &quot;#trEmbed&quot; + toTitleCase(type) + &quot;Body .tr-embed-&quot; + itemType + &quot;-row&quot;;
	if(portfolioVertical) {
		tableBodyRows = &quot;#trEmbed&quot; + toTitleCase(type) + &quot;VerticalBody .tr-embed-&quot; + itemType + &quot;-row&quot;;
	}
	$(tableBodyRows).each(function (i, row) {
		var rowId = $(row).attr(&quot;data-&quot; + itemType + &quot;-id&quot;);
		if(!!rowId &amp;&amp; $(row).find(&quot;div&quot;).length &gt; 0) {
			widgetIds.push(rowId);
		}
	});
	return widgetIds;
}

function addRow(itemType, snapshot, element) {
	var type = itemType + &quot;s&quot;;
	var trInstrument = tradableEmbed.getInstrumentFromSymbol(element.symbol);
	if(!portfolioVertical) {
		$(&quot;#trEmbed&quot; + toTitleCase(type) + &quot;Body&quot;).append(
			&quot;&lt;div class='tr-embed-&quot; + itemType + &quot;-row' data-&quot; + itemType + &quot;-id='&quot; + element.id + &quot;'&gt;&quot;
				+ &quot;&lt;div class='tr-embed-&quot; + itemType + &quot;-row-main'&gt;&quot;
					+ &quot;&lt;div class='tr-embed-&quot; + itemType + &quot;-row-top'&gt;&quot;
					  + &quot;&lt;div class='tr-embed-&quot;+type+&quot;-instrument'&gt;&quot; + trInstrument.brokerageAccountSymbol + &quot;&lt;/div&gt;&quot;
					  + &quot;&lt;div class='tr-embed-&quot;+type+&quot;-side'&gt;&lt;/div&gt;&quot; 
					  + &quot;&lt;div class='tr-embed-&quot;+type+&quot;-amount'&gt;&lt;/div&gt;&quot; 
					  + &quot;&lt;div class='tr-embed-&quot;+type+&quot;-open-price'&gt;&lt;/div&gt;&quot; 
					  + &quot;&lt;div class='tr-embed-&quot;+type+&quot;-current-price'&gt;&lt;/div&gt;&quot;
					  + ((type === &quot;positions&quot;) ? ((&quot;&lt;div class='tr-embed-&quot;+type+&quot;-pnl&quot;) + &quot;'&gt;&lt;/div&gt;&quot;) : (&quot;&quot;))
				  + &quot;&lt;/div&gt;&quot; 
				  + &quot;&lt;div class='tr-embed-&quot; + itemType + &quot;-row-bottom'&gt;&quot;
					  + &quot;&lt;div class='tr-embed-&quot;+type+&quot;-description'&gt;&quot; + trInstrument.displayName + &quot;&lt;/div&gt;&quot; 
					  + &quot;&lt;div class='tr-embed-&quot;+type+&quot;-change'&gt;&lt;/div&gt;&quot; 
					  + ((type === &quot;positions&quot;) ? ((&quot;&lt;div class='tr-embed-&quot;+type+&quot;-pnl-perc&quot;) + &quot;'&gt;&lt;/div&gt;&quot;) : (&quot;&quot;))
				  + &quot;&lt;/div&gt;&quot;
			  + &quot;&lt;/div&gt;&quot;
			  + &quot;&lt;div class='tr-embed-&quot;+type+&quot;-close'&gt;&lt;span class='tr-embed-separator'/&gt;&quot; + ((type === &quot;positions&quot;) ? &quot;Close&quot; : &quot;Cancel&quot;) + &quot;&lt;/div&gt;&quot; 
			  
			+ &quot;&lt;/div&gt;&quot;);
	} else {
		$(&quot;#trEmbed&quot; + toTitleCase(type) + &quot;VerticalBody&quot;).append(
			&quot;&lt;div class='tr-embed-&quot; + itemType + &quot;-row' data-&quot; + itemType + &quot;-id='&quot; + element.id + &quot;'&gt;&quot; 
			+ &quot;&lt;div class='tr-embed-&quot; + itemType + &quot;-card'&gt;&quot;
				+ &quot;&lt;div class='tr-embed-&quot;+type+&quot;-card-main'&gt;&quot;
					+ &quot;&lt;div class='tr-embed-&quot; + itemType + &quot;-card-top'&gt;&quot; 
						+ &quot;&lt;span class='tr-embed-&quot;+type+&quot;-instrument'&gt;&quot; + trInstrument.brokerageAccountSymbol + &quot;&lt;/span&gt;&quot;
						+ &quot;&lt;span class='tr-embed-&quot;+type+&quot;-&quot; + ((type === &quot;positions&quot;) ? &quot;pnl&quot; : &quot;amount&quot;) + &quot;'&gt;&quot; + ((type === &quot;orders&quot;) ? (&quot;&quot;) : (&quot;&quot;)) + &quot;&lt;/span&gt;&quot;
					+ &quot;&lt;/div&gt;&lt;div class='tr-embed-&quot;+type+&quot;-card-center'&gt;&quot;
						+ &quot;&lt;span class='tr-embed-&quot;+type+&quot;-side-holder'&gt;&quot; 
							+ &quot;&lt;span class='tr-embed-&quot;+type+&quot;-side'&gt;&lt;/span&gt;&lt;/span&gt;&quot;
						+ &quot;&lt;span class='tr-embed-&quot;+type+&quot;-open-price-holder'&gt;&quot;
							+ &quot;&lt;span class='tr-embed-&quot;+type+&quot;-open-price'&gt;&lt;/span&gt;&lt;/span&gt;&quot;
					+ &quot;&lt;/div&gt;&quot; 
				+ &quot;&lt;/div&gt;&quot;
				+ &quot;&lt;div class='tr-embed-&quot;+type+&quot;-card-east'&gt;&quot;
					+ &quot;&lt;span class='tr-embed-&quot;+type+&quot;-close'&gt;&quot; + closeButton + &quot;&lt;/span&gt;&quot;
				+ &quot;&lt;/div&gt;&quot;
			+ &quot;&lt;/div&gt;&lt;/div&gt;&quot;);
	}

	updateRow(itemType, snapshot, element);
}

function updateRow(itemType, snapshot, element) {
	var type = itemType + &quot;s&quot;;
	var rowElement = &quot;div&quot;;
	if(element.side === &quot;BUY&quot;) {
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-side&quot;).removeClass(&quot;tr-embed-&quot; + type + &quot;-short&quot;);
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-side&quot;).addClass(&quot;tr-embed-&quot; + type + &quot;-long&quot;);
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-side&quot;).html(((type === &quot;positions&quot;) ? &quot;&amp;#9650; Long&quot; : &quot;Buy &lt;span class='black'&gt;Limit&lt;/span&gt;&quot;));
	} else {
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-side&quot;).removeClass(&quot;tr-embed-&quot; + type + &quot;-long&quot;);
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-side&quot;).addClass(&quot;tr-embed-&quot; + type + &quot;-short&quot;);
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-side&quot;).html(((type === &quot;positions&quot;) ? &quot;&amp;#9660; Short&quot; : &quot;Sell &lt;span class='black'&gt;Limit&lt;/span&gt;&quot;));
	}
	
	var amt = prettyPrintNumber(element.amount);
	$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-amount&quot;).html(amt);
	var elemPrice = ((type === &quot;positions&quot;) ? element.openPrice : element.price);
	if(elemPrice !== null &amp;&amp; elemPrice !== undefined &amp;&amp; !isNaN(elemPrice)) {
		var styledPrice = getStyledPriceForSymbol(element.symbol, elemPrice)
		if(type === &quot;positions&quot; &amp;&amp; portfolioVertical) {
			$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-open-price&quot;).html(amt + &quot; @ &quot; + styledPrice);
		} else {
			$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-open-price&quot;).html(styledPrice);
		}
	} else {
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-open-price&quot;).html(&quot;&amp;nbsp;&quot;);
	}
	if(element.lastPrice!== null &amp;&amp; element.lastPrice!== undefined &amp;&amp; !isNaN(element.lastPrice)) {
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-current-price&quot;).html(getStyledPriceForSymbol(element.symbol, element.lastPrice));
		if(!!openingPricesObj[element.symbol] &amp;&amp; !!element.lastPrice) {
			var instrument = tradableEmbed.getInstrumentFromSymbol(element.symbol);
			var openPrice = openingPricesObj[element.symbol];
			var change = ((element.lastPrice - openPrice) * Math.pow(10, instrument.pipPrecision));
			var changeString = &quot;&quot;;
			if(change &gt;= 0) {
				changeString = &quot;&lt;span class='black'&gt;+&quot; + change.toFixed(2) + &quot;&lt;/span&gt; pips&amp;nbsp;&quot;;
			} else {
				changeString = &quot;&lt;span class='black'&gt;&quot; + change.toFixed(2) + &quot;&lt;/span&gt; pips&amp;nbsp;&quot;;
			}
			$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-change&quot;).html(changeString);
		}
	} else {
		$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-current-price&quot;).html(&quot;&amp;nbsp;&quot;);
	}
	if(type === &quot;positions&quot;) {
		if(element.openProfit !== undefined &amp;&amp; element.openProfit !== null) {
			$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl&quot;).removeClass(&quot;tr-embed-&quot; + type + &quot;-neutral&quot;);
			if(element.openProfit &gt;= 0) {
				$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl&quot;).removeClass(&quot;tr-embed-&quot; + type + &quot;-loss&quot;);
				$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl&quot;).addClass(&quot;tr-embed-&quot; + type + &quot;-profit&quot;);
			} else {
				$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl&quot;).removeClass(&quot;tr-embed-&quot; + type + &quot;-profit&quot;);
				$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl&quot;).addClass(&quot;tr-embed-&quot; + type + &quot;-loss&quot;);
			}

			$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl&quot;).html(getInAccountCurrencyFormat(element.openProfit));
		} else {
			$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl&quot;).addClass(&quot;tr-embed-&quot; + type + &quot;-neutral&quot;);
			$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl&quot;).html(&quot;&amp;nbsp;&quot;);
		}
		if(!portfolioVertical &amp;&amp; !!element.lastPrice &amp;&amp; !!element.openPrice) {
			var pnlPerc;
			if(element.side === &quot;BUY&quot;) {
				pnlPerc = ((element.lastPrice - element.openPrice) * 100) / element.openPrice;
			} else {
				pnlPerc = ((element.openPrice - element.lastPrice) * 100) / element.lastPrice;
			}
			pnlPerc = &quot;&lt;span class='black'&gt;&quot; + pnlPerc.toFixed(2) + &quot;&lt;/span&gt;%&quot;;
			$(rowElement+&quot;[data-&quot;+itemType+&quot;-id='&quot; + element.id + &quot;'] .tr-embed-&quot; + type + &quot;-pnl-perc&quot;).html(pnlPerc);
		}
	}
}

function executeClosePosition(positionId) {
	tradableEmbed.closePosition(positionId).then(function() {
		var posId = positionId;
		var interval = setInterval(function() {
			tradableEmbed.getPositionById(posId, function(position) {
				if(!!position &amp;&amp; position.closedProfit !== null) {
					var profitLoss = &quot;tr-embed-close-notify-profit&quot;;
					if(position.closedProfit &lt; 0) {
						profitLoss = &quot;tr-embed-close-notify-loss&quot;;
					}
					$.notify({msg: tradableEmbed.getInstrumentFromSymbol(position.symbol).brokerageAccountSymbol 
								+ &quot;&lt;span class='&quot; + position.side.toLowerCase() + &quot;'&gt; Closed &lt;/span&gt;&quot; 
								+&quot;&lt;span class='&quot; + profitLoss + &quot;'&gt;&quot; + getInAccountCurrencyFormat(position.closedProfit) + &quot;&lt;/span&gt;&quot;},
						{style: 'tr-embed-notify'});
					clearInterval(interval);
				}
			});
		}, 500);
		trackEvent('Position', {action: &quot;Closed&quot;, positionId: positionId});
	}, function(jqXHR) {
		$(&quot;div[data-position-id='&quot; + positionId + &quot;']&quot;).css({opacity: 1});
		handleError(&quot;Position Close Rejected&quot;, jqXHR.responseJSON);
		trackEvent('Position', {action: &quot;Close Rejected&quot;, positionId: positionId, cause: jqXHR.responseJSON});
	});
}

function executeCancelOrder(orderId) {
	tradableEmbed.cancelOrder(orderId).then(function() {
		trackEvent('Order', {action: &quot;Cancelled&quot;, orderId: orderId});
	}, function(jqXHR) {
		$(&quot;div[data-order-id='&quot; + orderId + &quot;']&quot;).css({opacity: 1});
		handleError(&quot;Order Cancel Rejected&quot;, jqXHR.responseJSON);
		trackEvent('Order', {action: &quot;Cancellation Rejected&quot;, orderId: orderId, cause: jqXHR.responseJSON});
	});
}

function getStyledPriceForSymbol(symbol, price, pipPrecision) {
	if(!price || price === 0) {
		return &quot;&amp;nbsp;&quot;;
	}
	var pipPrec = pipPrecision;
	if(pipPrec === null || pipPrec === undefined) {
		var instrument = tradableEmbed.getInstrumentFromSymbol(symbol);
		if(instrument !== null) {
			pipPrec = instrument.pipPrecision;
		} else {
			pipPrec = 1;
		}
	}
	
	var leftLimit = 3;
	if(pipPrec === 0) {
		leftLimit = 5;
	} else if(pipPrec === 1) {
		leftLimit = 2;
	}
	var openPrice = getInInstrumentFormat(pipPrec, price);

	return (&quot;&lt;span class='gray'&gt;&quot; + openPrice.substring(0, openPrice.length - leftLimit) 
		  + &quot;&lt;/span&gt;&lt;span class='highlight'&gt;&quot; + openPrice.substring(openPrice.length - leftLimit)) + &quot;&lt;/span&gt;&quot;;
}

///  Watch List  ///

var watchListVertical;
function buildWatchList() {
	$(document).ready(function () {
		if($(&quot;#tr-embed-watch-list&quot;).length) {
			$('#tr-embed-watch-list').addClass(&quot;tr-embed&quot;);
			loadWatchList();
		}
	});
}

function loadWatchList() {
	watchListVertical = false;
	if($('#tr-embed-watch-list').width() &lt; 400) {
		watchListVertical = true;
	} 
	$('#tr-embed-watch-list').load(path + &quot;html/watch-list.html&quot;, function() {
		$('#trEmbedWatchList').perfectScrollbar();
		$(&quot;#tr-embed-watch-list .tr-embed-widget-footer-logo&quot;).append(tradableVector);

		initializeAccountsInSelector(&quot;#trEmbedWatchListAccountsSelect&quot;, &quot;Watch List&quot;);

		setWatchListHorizontalOrVertical();

		$(&quot;#trEmbedWatchListHeader .tr-embed-tabs .tr-embed-tab&quot;).each(function(idx, elem){
			var ev = $._data(this, 'events');
			if(!(ev &amp;&amp; ev.click)) {
				$(elem).on(&quot;click&quot;, function (e) {
					e.preventDefault();
					if(!$(this).hasClass(&quot;tr-embed-tab-active&quot;)) {
						$(&quot;#trEmbedWatchListHeader .tr-embed-tabs .tr-embed-tab-active&quot;).removeClass(&quot;tr-embed-tab-active&quot;);
						$(this).addClass(&quot;tr-embed-tab-active&quot;);
						trackEvent('Watch List', {action: &quot;Category switch&quot;, source: &quot;Close button&quot;});
						clearWatchList();
						fillWatchList();
					}
				});
			}
		});
	});
}

function setWatchListHorizontalOrVertical() {
	if(!watchListVertical &amp;&amp; !($(&quot;.tr-embed-h-watch-list&quot;).length)) {
		$(&quot;#trEmbedWatchListBody&quot;).wrap(&quot;&lt;div class='tr-embed-h-watch-list'&gt;&lt;/div&gt;&quot;);
		clearWatchList();
		fillWatchList();
	} else if(watchListVertical) {
		if($(&quot;.tr-embed-h-watch-list&quot;).length) {
			$(&quot;#trEmbedWatchListBody&quot;).unwrap();
		}
		clearWatchList();
		fillWatchList();
	}
}

function clearWatchList() {
	$(&quot;#trEmbedWatchList .tr-embed-watch-list-row&quot;).each(function(idx, row) {
		var symbol = $(this).attr('data-symbol');
		tradableEmbed.removeSymbolFromUpdates(&quot;tr-embed-watchlist&quot;, symbol);
	});
	$(&quot;#trEmbedWatchList&quot;).empty();
}

var popular = [&quot;EURUSD&quot;, &quot;USDJPY&quot;, &quot;GBPUSD&quot;, &quot;USDCAD&quot;, &quot;USDCHF&quot;, &quot;AUDUSD&quot;, &quot;USOil&quot;, &quot;GoldUSD&quot;];
var indices = [&quot;UK100&quot;, &quot;AUS200&quot;, &quot;JPN225&quot;, &quot;GER30&quot;, &quot;ESP35&quot;, &quot;EUSTX50&quot;, &quot;FRA40&quot;, &quot;HKG33&quot;, &quot;ITA40&quot;, &quot;US100&quot;, &quot;US500&quot;, &quot;US30&quot;, &quot;SUI30&quot;];
var commodities = [&quot;UKOil&quot;, &quot;USOil&quot;, &quot;SilverCNH&quot;, &quot;SilverUSD&quot;, &quot;GoldCNH&quot;, &quot;GoldUSD&quot;, &quot;GoldEUR&quot;];

//Offline variables
var offlineFeedInterval;
var processingOfflinePrices = false;
var lastOfflinePrices;
var offlineForex = [&quot;EURUSD&quot;, &quot;USDJPY&quot;, &quot;GBPUSD&quot;, &quot;USDCAD&quot;, &quot;USDCHF&quot;, &quot;AUDUSD&quot;, &quot;EURJPY&quot;, &quot;EURCHF&quot;, &quot;EURCAD&quot;, &quot;EURGBP&quot;, &quot;EURAUD&quot;, &quot;NZDUSD&quot;];
var offlineIndices = [&quot;UK100&quot;, &quot;AUS200&quot;, &quot;JPN225&quot;, &quot;GER30&quot;, &quot;ESP35&quot;, &quot;EUSTX50&quot;, &quot;FRA40&quot;, &quot;ITA40&quot;, &quot;US100&quot;, &quot;US500&quot;, &quot;US30&quot;];
var offlineCommodities = [&quot;UKOil&quot;, &quot;USOil&quot;, &quot;SilverUSD&quot;, &quot;GoldUSD&quot;, &quot;GoldEUR&quot;];

var openingPricesObj = {};
function fillWatchList() {
	var category = $(&quot;#trEmbedWatchListHeader .tr-embed-tabs .tr-embed-tab-active&quot;).text().toUpperCase();
	var symbols = [];
	if(!!offlineFeedInterval) {
		clearInterval(offlineFeedInterval);
		offlineFeedInterval = undefined;
	}
	if(tradableEmbed.tradingEnabled) {
		$(&quot;#trEmbedWatchListHeader .tr-embed-tabs .tr-embed-tab&quot;).each(function(idx, elem){
			if($(this).text().indexOf(&quot;Forex&quot;) !== -1) {
				$(this).text(&quot;All&quot;);
			}
		});
		$(&quot;#trEmbedWatchListEnableTrading&quot;).hide();
		$(&quot;#trEmbedWatchListAccountsSelect&quot;).show();
		$(tradableEmbed.availableInstruments).each(function(idx, instrument) {
			if(category === &quot;ALL&quot;) {
				addIt(instrument);
			} else if(category === &quot;POPULAR&quot; &amp;&amp; $.inArray(instrument.symbol, popular) !== -1) {
				addIt(instrument);
			} else if(category === &quot;INDICES&quot; &amp;&amp; $.inArray(instrument.symbol, indices) !== -1) {
				addIt(instrument);
			} else if(category === &quot;COMMODITIES&quot; &amp;&amp; $.inArray(instrument.symbol, commodities) !== -1) {
				addIt(instrument);
			}
			function addIt(instrument) {
				addInstrumentToWatchList(instrument.symbol, instrument.brokerageAccountSymbol, instrument.displayName);
				if(openingPricesObj[instrument.symbol] === undefined) {
					symbols.push(instrument.symbol);
				}
			}
		});
		if(!!tradableEmbed.lastSnapshot) {
			updatePricesOnWatchList(tradableEmbed.lastSnapshot.prices);
		}
	} else {
		$(&quot;#trEmbedWatchListHeader .tr-embed-tabs .tr-embed-tab&quot;).each(function(idx, elem){
			if($(this).text().indexOf(&quot;All&quot;) !== -1) {
				$(this).text(&quot;Forex&quot;);
			}
		});
		$(&quot;#trEmbedWatchListAccountsSelect&quot;).hide();
		$(&quot;#trEmbedWatchListEnableTrading&quot;).show();
		$('#trEmbedWatchListEnableTrading').unbind();
		$('#trEmbedWatchListEnableTrading').on(&quot;click&quot;, function () {
			tradableEmbed.promptOrderEntry();
			trackEvent('Enable Trading Modal', {action: &quot;Open&quot;, source: &quot;Watch List Enable Button&quot;});
		});
		
		if(category === &quot;FOREX&quot;) {
			symbols = offlineForex;
		} else if(category === &quot;POPULAR&quot;) {
			symbols = popular;
		} else if(category === &quot;INDICES&quot;) {
			symbols = offlineIndices;
		} else if(category === &quot;COMMODITIES&quot;) {
			symbols = offlineCommodities;
		}
		$(symbols).each(function(idx, symbol) {
			addInstrumentToWatchList(symbol, symbol, getDescriptionForSymbolOffline(symbol));
		});
		if(!!lastOfflinePrices) {
			updatePricesOnWatchList(lastOfflinePrices);
		}
		offlineFeedInterval = setInterval(function() {
			if(!processingOfflinePrices) {
				processingOfflinePrices = true;
				tradableEmbed.makeCandleRequest(&quot;getQuotes&quot;, symbols, function(pricesObj) {
					lastOfflinePrices = pricesObj.quotes;
					updatePricesOnWatchList(pricesObj.quotes);
					processingOfflinePrices = false;
				});
			}
		}, 1000);
	}

	initializeDailyClosePricesForSymbolArray(symbols);
}

function initializeDailyClosePricesForSymbolArray(symbols) {
	// Initialize candles to calculate daily change
	if(symbols.length &gt; 0) {
		tradableEmbed.getDailyClose(symbols).then(function(candles) {
			$(candles).each(function(idx, candle) {
				openingPricesObj[candle.symbol] = candle.close;
			});
			$(symbols).each(function(idx, sym) {
				if(openingPricesObj[sym] === undefined) {
					openingPricesObj[sym] = null;
				}
			});
		});
	}
}

function addInstrumentToWatchList(symbol, displaySymbol, displayName) {
	var watchListRowPricesContent = 
		&quot;&lt;span class='tr-embed-watch-list-prices-bid'&gt;&lt;/span&gt;&quot;
		+ &quot;&amp;nbsp;&amp;nbsp;&lt;span class='tr-embed-watch-list-prices-spread'&gt;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&quot;
		+ &quot;&lt;span class='tr-embed-watch-list-prices-ask'&gt;&lt;/span&gt;&quot;;
	var watchListRowMiddle = &quot;&quot;;
	if(watchListVertical) {
		watchListRowMiddle = 
			&quot;&lt;div class='tr-embed-watch-list-top'&gt;&quot;
				  + &quot;&lt;div class='tr-embed-watch-list-instrument'&gt;&quot; + displaySymbol + &quot;&lt;/div&gt;&quot;
				  + &quot;&lt;div class='tr-embed-watch-list-prices'&gt;&quot; + watchListRowPricesContent + &quot;&lt;/div&gt;&quot;
			+ &quot;&lt;/div&gt;&quot;
			+ &quot;&lt;div class='tr-embed-watch-list-center'&gt;&quot;
				  + &quot;&lt;div class='tr-embed-watch-list-description'&gt;&quot; + displayName + &quot;&lt;/div&gt;&quot;
				  + &quot;&lt;div class='tr-embed-watch-list-change'&gt;&lt;/div&gt;&quot;
			+ &quot;&lt;/div&gt;&quot;;
	} else {
		watchListRowMiddle = 
			&quot;&lt;div class='tr-embed-watch-list-top'&gt;&quot;
				  + &quot;&lt;div class='tr-embed-watch-list-instrument'&gt;&quot; + displaySymbol + &quot;&lt;/div&gt;&lt;br/&gt;&quot;
				  + &quot;&lt;div class='tr-embed-watch-list-description'&gt;&quot; + displayName + &quot;&lt;/div&gt;&quot;
			+ &quot;&lt;/div&gt;&quot;
			+ &quot;&lt;div class='tr-embed-watch-list-center'&gt;&quot;
				+ &quot;&lt;div class='tr-embed-watch-list-prices'&gt;&quot; 
					+ &quot;&lt;div class='tr-embed-watch-list-change'&gt;&lt;/div&gt;&quot;
					+ watchListRowPricesContent 
				+ &quot;&lt;/div&gt;&quot;
			+ &quot;&lt;/div&gt;&quot;;
	}

	$(&quot;#trEmbedWatchList&quot;).append(
		&quot;&lt;div class='tr-embed-watch-list-row' data-symbol='&quot; + symbol + &quot;'&gt;&quot;
			+ &quot;&lt;div class='tr-embed-watch-list-middle'&gt;&quot;
				+ watchListRowMiddle
			+ &quot;&lt;/div&gt;&quot;
			+ &quot;&lt;div class='tr-embed-watch-list-east'&gt;&quot; + tradeIcon + &quot;&lt;/div&gt;&quot;
		+ &quot;&lt;/div&gt;&quot;);
	tradableEmbed.addSymbolToUpdates(&quot;tr-embed-watchlist&quot;, symbol);
	
	// Add order entry listeners
	$('#trEmbedWatchList .tr-embed-watch-list-row[data-symbol=&quot;' + symbol + '&quot;] .tr-embed-watch-list-east').on(&quot;click&quot;, function () {
		var symbol = $(this).closest('.tr-embed-watch-list-row').attr('data-symbol');
		tradableEmbed.promptOrderEntry(symbol);
		trackEvent('Watch List', {action: &quot;Open Trade&quot;, symbol: symbol});
	});
}

var lastPricesObj = {};
function updatePricesOnWatchList(prices) {
	$(prices).each(function(idx, price) {
		var spread;
		if(price.spread !== null &amp;&amp; price.spread !== undefined) {
			spread = parseFloat(price.spread);				
		} else if(price.pipPrecision !== null &amp;&amp; price.pipPrecision !== undefined){
			var pipMultiplier = Math.pow(10, price.pipPrecision);
			if(pipMultiplier &lt;= 0) {
				pipMultiplier = 1;
			}
			spread = Math.abs((price.ask * pipMultiplier) - (price.bid * pipMultiplier));
		}
		if(spread !== null &amp;&amp; spread !== undefined) {
			var spr = spread.toFixed(1);
			if(price.spread &gt;= 100) {
				spr = spread.toFixed(0);
			}
			$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-spread&quot;).html(spr);
		}
		$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-bid&quot;).html(getStyledPriceForSymbol(price.symbol, price.bid, price.pipPrecision));
		$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-ask&quot;).html(getStyledPriceForSymbol(price.symbol, price.ask, price.pipPrecision));
		
		if(!!lastPricesObj[price.symbol]) {
			var lastAsk = lastPricesObj[price.symbol].ask;
			var lastBid = lastPricesObj[price.symbol].bid;
			if(!!price.bid &amp;&amp; !!lastBid) {
				if(price.bid &gt; lastBid) {
					$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-bid .highlight&quot;).removeClass(&quot;down&quot;);
					$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-bid .highlight&quot;).addClass(&quot;up&quot;);
				} else if(price.bid &lt; lastBid) {
					$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-bid .highlight&quot;).removeClass(&quot;up&quot;);
					$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-bid .highlight&quot;).addClass(&quot;down&quot;);
				}
				if(price.ask &gt; lastAsk) {
					$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-ask .highlight&quot;).removeClass(&quot;down&quot;);
					$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-ask .highlight&quot;).addClass(&quot;up&quot;);
				} else if(price.ask &lt; lastAsk) {
					$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-ask .highlight&quot;).removeClass(&quot;up&quot;);
					$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-prices-ask .highlight&quot;).addClass(&quot;down&quot;);
				}
			}
		}
		lastPricesObj[price.symbol] = price;

		if(!!openingPricesObj[price.symbol] &amp;&amp; !!price.bid) {
			var openPrice = openingPricesObj[price.symbol];
			var change = ((price.bid - openPrice) / openPrice) * 100;
			var changeString = &quot;&quot;;
			if(change &gt;= 0) {
				$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-change&quot;).removeClass(&quot;down&quot;);
				$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-change&quot;).addClass(&quot;up&quot;);
				changeString = &quot;&lt;span class='tr-embed-change-arrow'&gt;&amp;#9650;&lt;/span&gt;+&quot; + change.toFixed(2) + &quot;%&quot;;
			} else {
				$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-change&quot;).removeClass(&quot;up&quot;);
				$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-change&quot;).addClass(&quot;down&quot;);
				changeString = &quot;&lt;span class='tr-embed-change-arrow'&gt;&amp;#9660;&lt;/span&gt;&quot; + change.toFixed(2) + &quot;%&quot;;
			}
			$(&quot;.tr-embed-watch-list-row[data-symbol='&quot; + price.symbol + &quot;'] .tr-embed-watch-list-change&quot;).html(changeString);
		}
	});
	$('#trEmbedWatchList').perfectScrollbar('update');
}

///  Order Entry  ///

function buildOrderEntryModal() {
	$(document).ready(function () {
		$(&quot;body&quot;).append(&quot;&lt;div id='trEmbedUIOrderEntry' class='tr-embed'&gt;&lt;/div&gt;&quot;);
		
		$('#trEmbedUIOrderEntry').load(path + 'html/order-entry.html', function() {

			$('#trEmbedAmountSelector').autoNumeric('init');
			$('#trEmbedLimitPrice').autoNumeric('init');

			buildInstrumentSelector();
			initializeOrderEntryModal();
			buildButtonGroups();
			initializeBottomButtons();
			setDisabledState();
			tradableEmbed.onEmbedReady(function() {
				initializeAccountsInSelector(&quot;#trEmbedAccounts&quot;, &quot;Order Entry&quot;);
			});
		});
	});
}

function initializeOrderEntryModal() {
	$('body').on('click', '.tr-embed-modal-overlay', function() {
		closeModal();
		if(tradableEmbed.tradingEnabled) {
			trackEvent('Order Entry', {action: &quot;Close&quot;, source: &quot;Overlay&quot;});
		} //else {trackEvent('Enable Trading Modal', {action: &quot;Close&quot;, source: &quot;Overlay&quot;});}
	});

	$(&quot;.tr-embed input[type='number'], .tr-embed input[type='text']&quot;).on(&quot;click&quot;, function () {
	   $(this).select();
	});

	$('#trEmbedCloseButton').click(function() {
		closeModal();
		trackEvent('Order Entry', {action: &quot;Close&quot;, source: &quot;Close button&quot;});
	});

	initializeHoverStates();

	$(window).resize(function() {
		adjustModalLocation();
	});
	$(window).resize();
}

function closeModal() {
	resetOrderEntry(false);
	$(&quot;.tr-embed-modal-box, .tr-embed-modal-overlay&quot;).fadeOut(100, function() {
		$(&quot;.tr-embed-modal-overlay&quot;).remove();
		try { // try-catch is a workaround for IE9 
			$('#instrumentSelector').catcomplete('close');
		} catch(err) {}
		$('#instrumentSelector').val('');
	});
	if(!!myQuotesTimer) {
		clearInterval(myQuotesTimer);
	}
	activeInstrument = null;
}

function initializeHoverStates() {
	$(&quot;#trEmbedBidPrice&quot;).hover(function() {
		if(getSelectedSide() === &quot;BUY&quot;) {
			$(&quot;#trEmbedBidPrice .tr-embed-prices-bid&quot;).css({color: &quot;#FF0064&quot;});
			$(&quot;#trEmbedBidPrice .tr-embed-prices-big-pip,&quot; +
			  &quot;#trEmbedBidPrice .tr-embed-prices-medium-pip,&quot; + 
			  &quot;#trEmbedBidPrice .tr-embed-prices-small-pip&quot;).css({color: &quot;black&quot;});
		}
	}, function() {
		if(getSelectedSide() === &quot;BUY&quot;) {
			resetSell();
		}
	});
	$(&quot;#trEmbedBidPrice&quot;).click(function() {
		setBidActive();
	});
	$(&quot;#trEmbedAskPrice&quot;).hover(function() {
		if(getSelectedSide() === &quot;SELL&quot;) {
			$(&quot;#trEmbedAskPrice .tr-embed-prices-ask&quot;).css({color: &quot;#26d1c1&quot;});
			$(&quot;#trEmbedAskPrice .tr-embed-prices-big-pip,&quot; +
			  &quot;#trEmbedAskPrice .tr-embed-prices-medium-pip,&quot; + 
			  &quot;#trEmbedAskPrice .tr-embed-prices-small-pip&quot;).css({color: &quot;black&quot;});
		}
	}, function() {
		if(getSelectedSide() === &quot;SELL&quot;) {
			resetBuy();
		}
	});
	$(&quot;#trEmbedAskPrice&quot;).click(function() {
		setAskActive();
	});
	function setBidActive() {
		$(&quot;#trEmbedBidPrice .tr-embed-prices-bid,&quot; +
		  &quot;#trEmbedBidPrice .tr-embed-prices-big-pip,&quot; +
		  &quot;#trEmbedBidPrice .tr-embed-prices-medium-pip&quot;).css({color: &quot;white&quot;});
		$(&quot;#trEmbedBidPrice .tr-embed-prices-small-pip&quot;).css({color: &quot;rgba(255, 255, 255, .6)&quot;});
		resetBuy();
	}
	function setAskActive() {
		$(&quot;#trEmbedAskPrice .tr-embed-prices-ask,&quot; +
		  &quot;#trEmbedAskPrice .tr-embed-prices-big-pip,&quot; +
		  &quot;#trEmbedAskPrice .tr-embed-prices-medium-pip&quot;).css({color: &quot;white&quot;});
		$(&quot;#trEmbedAskPrice .tr-embed-prices-small-pip&quot;).css({color: &quot;rgba(255, 255, 255, .6)&quot;});
		resetSell();
	}
	function resetBuy() {
		$(&quot;#trEmbedAskPrice .tr-embed-prices-ask&quot;).css({color: &quot;#CAF1F5&quot;});
		$(&quot;#trEmbedAskPrice .tr-embed-prices-big-pip,&quot; +
		  &quot;#trEmbedAskPrice .tr-embed-prices-medium-pip,&quot; + 
		  &quot;#trEmbedAskPrice .tr-embed-prices-small-pip&quot;).css({color: &quot;#999999&quot;});
	}
	function resetSell() {
		$(&quot;#trEmbedBidPrice .tr-embed-prices-bid&quot;).css({color: &quot;#FDCADE&quot;});
		$(&quot;#trEmbedBidPrice .tr-embed-prices-big-pip,&quot; +
		  &quot;#trEmbedBidPrice .tr-embed-prices-medium-pip,&quot; + 
		  &quot;#trEmbedBidPrice .tr-embed-prices-small-pip&quot;).css({color: &quot;#999999&quot;});
	}
	if(getSelectedSide() === &quot;SELL&quot;) {
		setBidActive();
	} else {
		setAskActive();
	}
}

function initializeBottomButtons() {
	$(&quot;#trEmbedPlaceOrder&quot;).click(function(e) {
		if(!!activeInstrument &amp;&amp; $.inArray(activeInstrument.symbol, tradableEmbed.availableSymbols ) !== -1) {
			$('#trEmbedPlaceOrder').prop('disabled', true);
			var amount = $(&quot;#trEmbedAmountSelector&quot;).autoNumeric('get');
			var side = getSelectedSide();
			trackEvent('Order Place', {type: getSelectedType(), amount: amount, side: side, symbol: activeInstrument.symbol});
			if(getSelectedType() === &quot;MARKET&quot;) {
				setTrading(getSelectedType(), activeInstrument, side, amount, 0);
				tradableEmbed.placeMarketOrder(amount, side, activeInstrument.symbol, function(order) {
					setSuccess();
					$.notify({msg: getOrderConfirmationMessage(order)}, 
							{style: 'tr-embed-notify'});
					$.extend(order, {action: &quot;Placed&quot;, type:&quot;MARKET&quot;});
					trackEvent('Order', order);
				}, function(jqXHR) {
					setRejection(&quot;Trade Rejected&quot;, jqXHR.responseJSON.message, jqXHR.responseJSON.details);
					handleError(&quot;Trade Rejected&quot;, jqXHR.responseJSON);
					trackEvent('Order', {action: &quot;Rejected&quot;, type:&quot;MARKET&quot;, cause: jqXHR.responseJSON});
				});
			} else {
				var price = getSelectedLimitPrice();
				setTrading(getSelectedType(), activeInstrument, side, amount, price);
				tradableEmbed.placeLimitOrder(amount, price, side, activeInstrument.symbol, function(order) {
					setSuccess();
					$.notify({msg: getOrderConfirmationMessage(order)},
						{style: 'tr-embed-notify'});
					$.extend(order, {action: &quot;Placed&quot;, type:&quot;LIMIT&quot;});
					trackEvent('Order', order);
				}, function(jqXHR) {
					setRejection(&quot;Order Rejected&quot;, jqXHR.responseJSON.message, jqXHR.responseJSON.details);
					handleError(&quot;Order Rejected&quot;, jqXHR.responseJSON);
					trackEvent('Order', {action: &quot;Rejected&quot;, type:&quot;LIMIT&quot;, cause: jqXHR.responseJSON});
				});
			}
		} else {
			$.notify(&quot;Please select a valid symbol&quot;, &quot;error&quot;);
			trackEvent('Order Place', {action: &quot;Invalid symbol&quot;, instrument: JSON.stringify(activeInstrument)});
		}
	});
	$(&quot;#trEmbedOk&quot;).click(function(e) {
		closeModal();
	});

	$(&quot;#trEmbedClose&quot;).click(function(e) {
		closeModal();
	});
	$(&quot;#trEmbedEdit&quot;).click(function(e) {
		resetOrderEntry(true);
		setActiveState();
	});
}

function handleError(message, error) {
	$.notify({msg: getOrderErrorMessage(message, error)}, 
			{style: 'tr-embed-notify'});
}

function getOrderConfirmationMessage(order) {
	var space = &quot;&amp;nbsp;&quot;;
	var instrument = tradableEmbed.getInstrumentFromSymbol(order.symbol);
	if(order.type === &quot;MARKET&quot;) {
		var action = &quot;Bought&quot;;
		if(order.side === &quot;SELL&quot;) {
			action = &quot;Sold&quot;;
		}
		return instrument.brokerageAccountSymbol + space + &quot;&lt;span class='&quot; + order.side.toLowerCase() + &quot;'&gt;&quot; 
			+ action + &quot;&lt;/span&gt;&amp;nbsp;&quot; + prettyPrintNumber(order.amount);
	} else {
		return instrument.brokerageAccountSymbol + space + &quot;&lt;span class='&quot; + order.side.toLowerCase() + &quot;'&gt;&quot; 
			+ toTitleCase(order.side) + &quot;&lt;/span&gt;&quot; + space + prettyPrintNumber(order.amount) + space 
			+ &quot;Limit&quot; + space + &quot;&lt;span class='at'&gt;@&lt;/span&gt;&quot; + space + getInInstrumentFormat(instrument.pipPrecision, order.price);
	}
}
function getOrderErrorMessage(message, error) {
	return &quot;&lt;span class='sell'&gt;&quot; + message + &quot; (code: &quot; + error.code + &quot;)&lt;/span&gt;&quot;;
}
function getSelectedLimitPrice() {
	var limitFieldValue = $(&quot;#trEmbedLimitPrice&quot;).autoNumeric('get');
	if(getSelectedLimitType() === &quot;PIPS&quot;) {
		return getPriceForPipDistance(limitFieldValue);
	} else {
		return parseFloat(limitFieldValue);
	}
}
function getPriceForPipDistance(pips) {
	if(!!activeInstrument &amp;&amp; !!lastAsk &amp;&amp; !!lastBid) {
		var pipSize = getPipSizeForInstrument(activeInstrument);
		if(getSelectedSide() === &quot;BUY&quot;) {
			return lastAsk - (pipSize * pips);
		} else {
			return lastBid + (pipSize * pips);
		}
	} else {
		console.info(&quot;Instrument not found getting price for pip distance&quot;);
		return null;
	}
}
function getPipSizeForInstrument(selectedInstrument) {
	var pipSize = 1;
	if(selectedInstrument.pipPrecision &gt; 0) {
		pipSize = 1 / (Math.pow(10, selectedInstrument.pipPrecision));
	}
	return pipSize;
}
function getSelectedSide() {
	return $(&quot;#trEmbedSideGroup :radio:checked + label&quot;).attr('side');
}
function getSelectedType() {
	return $(&quot;#trEmbedTypeGroup :radio:checked + label&quot;).text().toUpperCase();
}
function getSelectedLimitType() {
	return $(&quot;#trEmbedLimitGroup :radio:checked + label&quot;).text().toUpperCase();
}
var selectedPips;
    function buildButtonGroups() {
    $(document).ready(function () {
		$(&quot;#trEmbedSideGroup&quot;).buttonset();
		$('#trEmbedSideGroup').change(function() {
			if(getSelectedType() === &quot;LIMIT&quot; &amp;&amp; getSelectedLimitType() !== &quot;PIPS&quot;) {
				setDefaultLimitLevelForCurrentInstrumentAndSide();
			}
			trackEvent('Order Entry', {action: &quot;Order Side Switch&quot;, side: getSelectedSide()});
		});

		$(&quot;#trEmbedTypeGroup&quot;).buttonset();
		$(&quot;#trEmbedLimitLevel&quot;).hide();
		$('#trEmbedTypeGroup').change(function() {
			if(getSelectedType() === &quot;LIMIT&quot;) {
				$(&quot;#trEmbedLimitLevel&quot;).show();
				$(&quot;.tr-embed-order-entry-title&quot;).html(&quot;New Order&quot;);
			} else {
				$(&quot;#trEmbedLimitLevel&quot;).hide();
				$(&quot;.tr-embed-order-entry-title&quot;).html(&quot;New Trade&quot;);					
			}
			setCurrentModeOnPlaceOrderButton();
			trackEvent('Order Entry', {action: &quot;Order Type Switch&quot;, side: getSelectedType()});
		});

		if(!selectedPips) {
			selectedPips = 25;
		}

		$(&quot;#trEmbedLimitGroup&quot;).buttonset();
		$(&quot;#trEmbedLimitGroup&quot;).change(function() {
			setCorrespondentLimitNumericType();
			trackEvent('Order Entry', {action: &quot;Limit Type Switch&quot;, side: getSelectedLimitType()});
		});
  	});
    }

function setCorrespondentLimitNumericType() {
	if(getSelectedLimitType() === &quot;PIPS&quot;) {
		initializeNumericSelector(&quot;#trEmbedLimitPrice&quot;, 1, 0, selectedPips);
	} else {
		selectedPips = $(&quot;#trEmbedLimitPrice&quot;).autoNumeric('get')
		setDefaultLimitLevelForCurrentInstrumentAndSide();
	}
}

    function setDefaultLimitLevelForCurrentInstrumentAndSide() {
	if(!!activeInstrument) {
		var curPipSize = getPipSizeForInstrument(activeInstrument);
		var initialValue = getInInstrumentFormat(activeInstrument.pipPrecision, getPriceForPipDistance($(&quot;#trEmbedLimitPrice&quot;).autoNumeric('get')));
		initializeNumericSelector(&quot;#trEmbedLimitPrice&quot;, curPipSize, (activeInstrument.pipPrecision+1), initialValue);
	} else {
		console.info(&quot;Instrument not found trying to calculate new limit level&quot;);
	}
    }

    var ignoreListener = false;
function initializeAccountsInSelector(selector, eventSource) {
    	$(document).ready(function () {
		// Initialize accounts
		
		if(tradableEmbed.tradingEnabled) {
			$(selector).ddslick('destroy');
		}

		$(selector).find('option').remove();
		$(tradableEmbed.accounts).each(function(index, acc){
			var selected = &quot;&quot;;
			if(tradableEmbed.selectedAccount.uniqueId === acc.uniqueId) {
				selected = &quot;selected&quot;;
			}
			$(selector).append(&quot;&lt;option data-imagesrc='&quot; + acc.brokerLogos.small  + &quot;' &quot; 
					+ &quot; value='&quot;+acc.uniqueId+&quot;' &quot; + selected + &quot;&gt;&quot;+acc.displayName+&quot;&lt;/option&gt;&quot;);
		});
		
		if(tradableEmbed.tradingEnabled) {
			var imagePosition = &quot;left&quot;;
			var bg = &quot;#FAFAFA&quot;;
			if(selector === &quot;#trEmbedAccounts&quot;) {
				imagePosition = 'right';
				bg = &quot;rgba(255, 255, 255, .05)&quot;;
			}
			$(selector).ddslick({ width: &quot;100%&quot;, background: bg, imagePosition: imagePosition,
				onSelected: function (selectedData) {
					//callback function: do something with selectedData;
					if(!ignoreListener) {
						ignoreListener = true;
						console.log('Setting new account');
						$('#trEmbedPlaceOrder').prop('disabled', true);
						clearRows();
						clearWatchList();
						var newAccountId = selectedData.selectedData.value;
						var newAccountIdx = selectedData.selectedIndex;

						//Need to pass a string, because index 0 doesn't work otherwise
						$(&quot;#trEmbedAccounts&quot;).ddslick('select', {index: String(newAccountIdx)});
						$(&quot;#trEmbedPositionsAccountsSelect&quot;).ddslick('select', {index: String(newAccountIdx)});
						$(&quot;#trEmbedOrdersAccountsSelect&quot;).ddslick('select', {index: String(newAccountIdx)});
						$(&quot;#trEmbedWatchListAccountsSelect&quot;).ddslick('select', {index: String(newAccountIdx)});
						$(&quot;#trEmbedDashboardAccountsSelect&quot;).ddslick('select', {index: String(newAccountIdx)});

						tradableEmbed.setSelectedAccount(newAccountId, function() {
							$('#trEmbedPlaceOrder').prop('disabled', false);
							trackEvent('Account Switch', {source: eventSource});
							fillWatchList();
							setCurrentModeOnPlaceOrderButton();
							ignoreListener = false;
						}, function() {
							ignoreListener = false;
						});
					}
				}
			});
		}
    	});
    }

function setCurrentModeOnPlaceOrderButton() {
	if(tradableEmbed.tradingEnabled) {
		if(getSelectedType() === &quot;LIMIT&quot;) {
			if(tradableEmbed.selectedAccount.isLiveAccount) {
				$(&quot;#trEmbedPlaceOrder&quot;).html(&quot;Place Order&quot;);
			} else {
				$(&quot;#trEmbedPlaceOrder&quot;).html(&quot;Place Practice Order&quot;);
			}
		} else {
			if(tradableEmbed.selectedAccount.isLiveAccount) {
				$(&quot;#trEmbedPlaceOrder&quot;).html(&quot;Place Trade&quot;);
			} else {
				$(&quot;#trEmbedPlaceOrder&quot;).html(&quot;Place Practice Trade&quot;);
			}
		}
	}
}

    var catgry;
    function buildInstrumentSelector() {
    	$(document).ready(function () {
    		tradableEmbed.onEmbedReady(function () {
			if(tradableEmbed.tradingEnabled) {
				//Create instrument selector and listen to changes
				var instruments = [];
				$(tradableEmbed.availableCategories).each(function(i, cat) {
					catgry = cat;
					$(tradableEmbed.availableInstruments).each(function(idx, ins) {
						if(catgry === ins.type) {
							var autoInstrument = {
								label: ins.brokerageAccountSymbol,
								desc: ins.displayName,
								category: ins.type
							};
							instruments.push(autoInstrument);
						}
					});
				});

				$.widget( &quot;custom.catcomplete&quot;, $.ui.autocomplete, {
					_create: function() {
					  this._super();
					  this.widget().menu( &quot;option&quot;, &quot;items&quot;, &quot;&gt; :not(.tr-embed-autocomplete-category)&quot; );
					},
					_renderMenu: function( ul, items ) {
						var self = this,
						currentCategory = &quot;&quot;;
						$.each(items, function(index, item) {
							if (item.category != currentCategory) {
								ul.append(&quot;&lt;li style='clear:both'class='ui-autocomplete-category tr-embed-autocomplete-category'&gt;&quot; + item.category + &quot;&lt;/li&gt;&quot;);
								currentCategory = item.category;
							}
							self._renderItemData(ul, item);
						});
					},
					_renderItem : function( ul, item ) {
					  return $( &quot;&lt;li&gt;&quot; )
						.attr( &quot;data-value&quot;, item.label )
						.append( &quot;&lt;a class='tr-embed-autocomplete-item'&gt;&quot; + item.label 
							+ &quot;&lt;br&gt;&lt;span class='tr-embed-autocomplete-desc'&gt;&quot; + item.desc + &quot;&lt;/span&gt;&lt;/a&gt;&quot; )
						.appendTo( ul );
					}
				});

				$(&quot;#instrumentSelector&quot;).catcomplete({
				  appendTo: &quot;.tr-embed-instruments&quot;,
				  minLength: 0,
				  source:instruments,
				  autoFocus: true,
				  change: function(event, ui) {
						instrumentChangeListener();
				  },
				  close: function (event, ui) {
						instrumentChangeListener();
				  },
				  open: function() {
				  	//Fix the autocomplete position
					var position = $(&quot;.tr-embed-instruments &gt; ul&quot;).position(), top = position.top;
					$(&quot;.tr-embed-instruments &gt; ul&quot;).css({top: top - 2 + &quot;px&quot;, left: 0 + &quot;px&quot; });
				  }
				});
				$(&quot;#instrumentSelector&quot;).keydown(function() {
					instrumentChangeListener();
				});
				$(&quot;#instrumentSelector&quot;).focusout(function() {
					if(!!activeInstrument &amp;&amp; $(&quot;#instrumentSelector&quot;).val() !== activeInstrument.brokerageAccountSymbol) {
						$(&quot;#instrumentSelector&quot;).val(activeInstrument.brokerageAccountSymbol);
					}
				});
			}
    		});
    	});
    }
    var activeInstrument = null;
    var myQuotesTimer = null;
var instrumentChangeListener = function() {
	var newSymbol = $(&quot;#instrumentSelector&quot;).val();
	setInstrumentSymbol(newSymbol);
};
function setInstrumentSymbol(newSymbol) {
	var newInstrument = tradableEmbed.getInstrumentFromBrokerageAccountSymbol(newSymbol);
	if(!!newInstrument &amp;&amp; (!activeInstrument || (newInstrument.brokerageAccountSymbol !== activeInstrument.brokerageAccountSymbol))) {
		activeInstrument = newInstrument;
		lastAsk = null;
		lastBid = null;
		if(!!myQuotesTimer) {
			clearInterval(myQuotesTimer);
			myQuotesTimer = null;
		}
		if($.inArray( activeInstrument.symbol, tradableEmbed.availableSymbols ) !== -1) {
			setAccessingMarket();
			myQuotesTimer = setInterval(updatePrices, 400);
			trackEvent('Order Entry', {action: &quot;Instrument Changed&quot;, symbol: newSymbol});
		} else {
			setDisabledState();
		}
	}
}
var accessingMarket;
function setAccessingMarket() {
	accessingMarket = true;

	$('.tr-embed-prices-msg').hide();
	$('.tr-embed-prices-titles').hide();
	$('.tr-embed-prices-numbers').hide();
	$('.tr-embed-trading').hide();
	$('#trEmbedSpreadPrice').hide();

	$('.tr-embed-details').show();
	$('.tr-embed-instruments').show();
	$('.tr-embed-prices-accessing-mkt').show();
}
function setActiveState() {
	accessingMarket = false;
	$('#trEmbedPlaceOrder').prop('disabled', false);

	$('.tr-embed-prices-accessing-mkt').hide();
	$('.tr-embed-trading').hide();

	$('.tr-embed-prices-titles').show();
	$('.tr-embed-prices-numbers').show();
	$('#trEmbedSpreadPrice').show();
	$('.tr-embed-instruments').show();
	$('.tr-embed-details').show();
}
function setDisabledState() {
	accessingMarket = false;

	$('.tr-embed-prices-accessing-mkt').hide();
	$('.tr-embed-prices-titles').hide();
	$('.tr-embed-prices-numbers').hide();
	$('.tr-embed-trading').hide();
	$('#trEmbedSpreadPrice').hide();

	$('.tr-embed-instruments').show();
	$('.tr-embed-details').show();
	$('.tr-embed-prices-msg').show();

	$('#trEmbedPlaceOrder').prop('disabled', true);
}
function setTrading(type, instrument, side, amount, price) {
	$('#trEmbedPlaceOrder').hide();
	$('.tr-embed-prices-accessing-mkt').hide();
	$('.tr-embed-prices-msg').hide();
	$('.tr-embed-prices-titles').hide();
	$('.tr-embed-prices-numbers').hide();
	$('#trEmbedSpreadPrice').hide();

	$('.tr-embed-instruments').hide();
	$('.tr-embed-details').hide();
	$('.tr-embed-trading').show();
	$('.tr-embed-trading .tr-embed-check-animation').html(checkAnimated);
	initAnimation();
	
	var html = &quot;&quot;;
	if(type === &quot;MARKET&quot;) {
		var buySell;
		if(side === &quot;BUY&quot;) {
			buySell	= &quot;&lt;span class='buy'&gt;Buying&lt;/span&gt;&amp;nbsp;&quot;
		} else {
			buySell	= &quot;&lt;span class='sell'&gt;Selling&lt;/span&gt;&amp;nbsp;&quot;
		}
		html = instrument.brokerageAccountSymbol + &quot;&lt;br/&gt;&quot; + buySell + prettyPrintNumber(amount);
	} else {
		var buySell;
		if(side === &quot;BUY&quot;) {
			buySell	= &quot;&lt;span class='buy'&gt;Buy&lt;/span&gt;&amp;nbsp;&quot;
		} else {
			buySell	= &quot;&lt;span class='sell'&gt;Sell&lt;/span&gt;&amp;nbsp;&quot;
		}
		html = instrument.brokerageAccountSymbol
				+ &quot;&lt;br/&gt;&quot; + buySell + prettyPrintNumber(amount) 
				+ &quot;&lt;br/&gt;&lt;span class='gray'&gt;at&lt;/span&gt;&lt;br/&gt;Limit &quot; + getInInstrumentFormat(instrument.pipPrecision, price);
	}
	$('.tr-embed-trading-message').html(html);
}

function resetOrderEntry(now) {
	if(!!closeTimeout) {
		clearTimeout(closeTimeout);
	}
	closeTimeout = undefined;
	if(now) {
		clear();
	} else {
		setTimeout(function() {
			clear();
		}, 150);
	}
	function clear() {
		$('.tr-embed-trading .tr-embed-check-animation').empty();
		
		$('#trEmbedOk').text(&quot;OK&quot;);
		$('#trEmbedOk').hide();
		$('.tr-embed-rejection-footer').hide();

		$('#trEmbedPlaceOrder').show();
		$('.tr-embed-footer').show();
	}
}

var closeTimeout;
function setSuccess() {
	setConfirmationAnimationCheck();

	$('#trEmbedOk').show();
	
	var replaced = $('.tr-embed-trading-message').html().replace('Buying', 'Bought');
	$('.tr-embed-trading-message').html(replaced);

	replaced = $('.tr-embed-trading-message').html().replace('Selling', 'Sold');
	$('.tr-embed-trading-message').html(replaced);
	closeTimeout = setTimeout(function() {
		closeModal();
		resetOrderEntry(false);
	}, 5000);
}

function setRejection(title, message, details) {
	setConfirmationAnimationError();
	
	$('.tr-embed-footer').hide();
	$('.tr-embed-rejection-footer').show();

	message = message.substring(0, 120);
	$('.tr-embed-trading-message').html(title + &quot;&lt;br&gt;&lt;br&gt;&quot; + &quot;&lt;div class='tr-embed-trading-rejection-message'&gt;&quot; + message + &quot;&lt;/div&gt;&quot;);
	if(details !== null) {
		$('.tr-embed-trading-rejection-message').attr(&quot;title&quot;, details);
	}

	closeTimeout = setTimeout(function() {
		closeModal();
		resetOrderEntry(false);
	}, 10000);
}

var processingPriceUpdate = false;
function updatePrices() {
	if(!!activeInstrument &amp;&amp; $.inArray(activeInstrument.symbol, tradableEmbed.availableSymbols ) !== -1 &amp;&amp; !processingPriceUpdate) {
		processingPriceUpdate = true;
		tradableEmbed.getPrices([activeInstrument.symbol], function(prices) {
			if(!!activeInstrument) {
				var price = getPriceFromList(activeInstrument.symbol, prices);
				if(!!price) {
					if(price.ask !== null &amp;&amp; price.bid !== null  &amp;&amp; price.spread !== null 
						&amp;&amp; price.ask !== undefined &amp;&amp; price.bid !== undefined  &amp;&amp; price.spread !== undefined
						&amp;&amp; !isNaN(price.ask) &amp;&amp; !isNaN(price.bid) &amp;&amp; !isNaN(price.spread)) {
						var instrument = handleQuoteChange(price);
						if(accessingMarket) {
							initializeNumericSelector('#trEmbedAmountSelector', instrument.minAmount, 0, instrument.minAmount * 10);
							setCorrespondentLimitNumericType();
							setActiveState();
						}
					} else {
						console.log(&quot;Prices not ready for &quot;+activeInstrument.symbol+&quot;: &quot; + JSON.stringify(price));
					}
				}
			}
			processingPriceUpdate = false;
		}, function() {
			processingPriceUpdate = false;
		});
	} else if(!activeInstrument || $.inArray(activeInstrument.symbol, tradableEmbed.availableSymbols ) === -1){
		setDisabledState();
	}
}
function initializeNumericSelector(selector, minAmount, decimals, initialValue) {
	$(selector).autoNumeric('update', {vMin: '0', mDec: String(decimals)});
	$(selector).autoNumeric('set', initialValue);
	$(selector).attr(&quot;data-amt-min&quot;, minAmount);
	$(selector).attr(&quot;data-amt-step&quot;, minAmount);
	$(selector).unbind(&quot;keydown.trembedupdownevent&quot;);
	$(selector).bind(&quot;keydown.trembedupdownevent&quot;, function(e) {
		if($(selector).val() === &quot;0&quot; || !$(selector).val()) {
			$(selector).autoNumeric('set', minAmount);
			return;
		}
		var current = parseFloat($(selector).autoNumeric('get'));
		var step = parseFloat($(selector).attr(&quot;data-amt-step&quot;));
		switch(e.which) {
			case 38: $(selector).autoNumeric('set', (current + step)); break; //up
			case 40: $(selector).autoNumeric('set', (current - step)); break; //down
			default: return; // exit this handler for other keys
		}
		e.preventDefault(); // prevent the default action (scroll / move caret)
	});
	$(selector).unbind(&quot;change.trembedresetmin paste.trembedresetmin keyup.trembedresetmin&quot;);
	$(selector).bind(&quot;change.trembedresetmin paste.trembedresetmin keyup.trembedresetmin&quot;, function() {
		var min = parseFloat($(selector).attr(&quot;data-amt-min&quot;));
		if($(selector).val() === &quot;0&quot; || !$(selector).val()) {
			$(selector).autoNumeric('set', min);
		}
	});
	$(selector).unbind(&quot;focusout.trembedresetmin&quot;);
	$(selector).bind(&quot;focusout.trembedresetmin&quot;, function() {
		var current = parseFloat($(selector).autoNumeric('get'));
		var min = parseFloat($(selector).attr(&quot;data-amt-min&quot;));
		if(current &lt; min) {
			$(selector).autoNumeric('set', min);
		}
	});
}
function handleQuoteChange(price) {
	var instrument = tradableEmbed.getInstrumentFromSymbol(price.symbol);

	var leftLimit = 3;
	var rightLimit = 1;
	
	if(instrument.pipPrecision === 0) {
		leftLimit = 5;
		rightLimit = 3;
	} else if(instrument.pipPrecision === 1) {
		leftLimit = 2;
		rightLimit = 1;
	}
	
	var spread = price.spread.toFixed(1);
	if(price.spread &gt;= 100) {
		spread = price.spread.toFixed(0);
	}
	
	$(&quot;#trEmbedSpreadPrice&quot;).html(spread);
	setPricesForBidOrAsk(&quot;trEmbedAskPrice&quot;, 
		getInInstrumentFormat(instrument.pipPrecision, price.ask),
		leftLimit, rightLimit, getAskUpOrDown(price.ask));
	setPricesForBidOrAsk(&quot;trEmbedBidPrice&quot;, 
		getInInstrumentFormat(instrument.pipPrecision, price.bid),
		leftLimit, rightLimit, getBidUpOrDown(price.bid));
	return instrument;
}
function getInInstrumentFormat(pipPrecision, price) {
	var decimals = pipPrecision + 1;
	if(pipPrecision === 0) {
		decimals = 2;
	}
	return price.toFixed(decimals);
}

var lastAsk = null;
function getAskUpOrDown(price) {
	var upDown = 0;
	if(!!lastAsk) {
		if(price &gt; lastAsk) {
			upDown = 1;
		} else if(price &lt; lastAsk) {
			upDown = -1;
		}
		lastAsk = price;
	} else {
		lastAsk = price;
	}
	return upDown;
}

var lastBid = null;
function getBidUpOrDown(price) {
	var upDown = 0;
	if(!!lastBid) {
		if(price &gt; lastBid) {
			upDown = 1;
		} else if(price &lt; lastBid) {
			upDown = -1;
		}
		lastBid = price;
	} else {
		lastBid = price;
	}
	return upDown;
}

function setPricesForBidOrAsk(container, price, leftLimit, rightLimit, upDown) {
	var left = price.substring(0, price.length - leftLimit);	
	var big = price.substring((price.length - leftLimit), (price.length - rightLimit));
	var right = price.substring(price.length - rightLimit);
	
	$(&quot;#&quot; + container + &quot; span.tr-embed-prices-small-pip&quot;).html(left);
	$(&quot;#&quot; + container + &quot; span.tr-embed-prices-big-pip&quot;).html(big);
	$(&quot;#&quot; + container + &quot; span.tr-embed-prices-medium-pip&quot;).html(right);
}

///  Adjusting styles for responsive vs non-responsive  ///

    var responsiveMode;
    function adjustStyle(width) {
	var matches;
	try {
		if (window.matchMedia('(max-device-width: 960px)').matches) {
			matches = true;
			responsiveMode = true;
			console.log(&quot;Applying responsive...&quot;);
			$(&quot;#tradableEmbedCSS&quot;).attr(&quot;href&quot;, path + 'css/tradable-embed-mobile' + extension);
			if(!!$.notify) {
				var position = &quot;top right&quot;;
				if($(window).width() &lt; 350) {
					position = &quot;top left&quot;;
				}
				$.notify.defaults( {
				  globalPosition: position
				});
			}
    	} else {
    		matches = false;
    	}
	} catch(err) {
		matches = false;
	}

    if(!matches &amp;&amp; (responsiveMode === undefined || responsiveMode)) {
    	responsiveMode = false;
		console.log(&quot;Applying wide...&quot;);
		$(&quot;#tradableEmbedCSS&quot;).attr(&quot;href&quot;, path + 'css/tradable-embed-wide' + extension);
		if(!!$.notify) {
			$.notify.defaults( {
			  globalPosition: 'bottom right'
			});
		}
    }
	
	// Adjust widget styles

    if(dashboardVertical !== undefined &amp;&amp; !dashboardVertical &amp;&amp; $('#tr-embed-dashboard').width() &lt; 425) {
		buildDashboard();
	} else if(dashboardVertical !== undefined &amp;&amp; dashboardVertical &amp;&amp; $('#tr-embed-dashboard').width() &gt; 425) {
		buildDashboard();
	}

	if(portfolioVertical !== undefined &amp;&amp; !portfolioVertical &amp;&amp; $('#tr-embed-portfolio').width() &lt; 450) {
		loadWidget(getCurrentPortfolioType());
	} else if(portfolioVertical !== undefined &amp;&amp; portfolioVertical &amp;&amp; $('#tr-embed-portfolio').width() &gt; 450) {
		loadWidget(getCurrentPortfolioType());
	}

	if(watchListVertical !== undefined &amp;&amp; !watchListVertical &amp;&amp; $('#tr-embed-watch-list').width() &lt; 400) {
		watchListVertical = true;
		setWatchListHorizontalOrVertical();
	} else if(watchListVertical !== undefined &amp;&amp; watchListVertical &amp;&amp; $('#tr-embed-watch-list').width() &gt; 400) {
		watchListVertical = false;
		setWatchListHorizontalOrVertical();
	}
}

function adjustModalLocation() {
	var modalToAdjust = &quot;.tr-embed-modal-box&quot;;
	if(!tradableEmbed.tradingEnabled) {
		modalToAdjust = &quot;.tr-embed-enable-modal-box&quot;;
	}
	
	var left = ($(window).width() - $(modalToAdjust).outerWidth()) / 2;
	$(modalToAdjust).css({
		&quot;top&quot;: &quot;50%&quot;,
		&quot;left&quot;: left,
		&quot;margin-top&quot;: (0 - (($(modalToAdjust).outerHeight()) / 2))
	});
}

///  Helper methods  ///

function authenticateWithWindow(source) {
	tradableEmbed.authenticateWithWindow();
	trackEvent(&quot;Enable trading&quot;, {source: source});
}

function prettyPrintNumber(x) {
	return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, &quot;,&quot;);
}

function toTitleCase(str){
	return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}

function getJSPath() {
	var scr = document.getElementsByTagName(&quot;script&quot;);
	var fullPath = scr[scr.length-1].src;
	var path = fullPath.substring(fullPath, fullPath.lastIndexOf(&quot;/&quot;)+1);
	return path;
}

    function injectCSS(id, path){
    	//&quot;oldschool&quot; way of doing it, which hopefully works accross all browsers. 
    	//In theory we could use setAttribute, unfortunately IE6 doesn't support it consistently.
	var cssId = id;
	if (!document.getElementById(cssId)){
		var head  = document.getElementsByTagName('head')[0];
		var link  = document.createElement('link');
		link.id   = cssId;
		link.rel  = 'stylesheet';
		link.type = 'text/css';
		link.href = path;
		link.media = 'all';
		head.appendChild(link);
	}
    }

    function initTracking() {
    	if(!analyticsReady) {
    		tradableEmbed.getUser().then(function(user) {
			var userId = user.userId;
			var lengthToUse = Math.floor(userId.length/2);
			var idToUse = userId.slice(0, lengthToUse);
			analytics.identify(idToUse, {
			  email: idToUse + '@example.com',
			  appId: tradableEmbed.app_id
			});
			console.log(&quot;Analytics initialized...&quot;);
			analyticsReady = true;
		});
    	}
}
var analyticsReady = false;
function trackEvent(eventTitle, eventObj) {
	if(analyticsReady) {
		if(!!eventObj) {
			eventObj.brokerName = tradableEmbed.selectedAccount.brokerName;
			analytics.track(eventTitle, eventObj);
		} else {
			analytics.track(eventTitle, {
				brokerName: tradableEmbed.selectedAccount.brokerName
			});
		}		
	} else {
		if(!!eventObj) {
			analytics.track(eventTitle, eventObj);
		} else {
			analytics.track(eventTitle, {});
		}
	}
}

function getPriceFromList(symbol, list) {
    	var price = null;
	$(list).each(function(index, priceObj){
		if(priceObj.symbol === symbol) {
			price = priceObj;
			return false;
		}
	});
	return price;
    }

///  Instrument Helpers  ///

    var symbols = [
	'NZDCAD','EURNZD','USDRUB','EURCHF','USDHUF','HKDJPY','USDJPY','USDPLN','CADCHF',
	'USDTHB','EURUSD','USDKRW','USDINR','GBPUSD','XAGCNH','AUDNOK','ZARJPY','NZDCHF',
	'GBPSEK','EURTRY','USDSEK','AUDCAD','GBPJPY','GBPPLN','EURMXN','USDNOK','EURZAR',
	'XAUUSD','EURILS','EURAUD','USDCAD','EURCZK','GBPDKK','NZDUSD','USDDKK','EURSEK',
	'USDHKD','USDTRY','GBPTRY','SGDJPY','AUDCHF','AUDNZD','EURCAD','XAUCNH','USDILS',
	'USDZAR','NOKSEK','GBPNOK','EURNOK','CHFPLN','GBPCAD','CHFJPY','USDMXN','EURGBP',
	'EURPLN','GBPCHF','EURJPY','EURHUF','CHFNOK','CADJPY','USDCHF','GBPNZD','AUDUSD',
	'XAUEUR','GBPAUD','NZDJPY','USDSGD','XAGUSD','GBPZAR','AUDJPY','NOKJPY','GOOG', 
	'AAPL','MSFT','FB','IBM','VTI','VYM','AMZN','WMT','PFE','JNJ','GE','BA','RTN'
];

var symbolNicknames = {
	'EUPPY': 'EURJPY',
	'YUPPY': 'EURJPY',
	'AUSSIE': 'AUDUSD',
	'OZZIE': 'AUDUSD',
	'MATIE': 'AUDUSD',
	'CHUNNEL': 'EURGBP',
	'FIBER': 'EURUSD',
	'GEPPY': 'GBPJPY',
	'GOPHER': 'GBPJPY',
	'GUPPY': 'GBPJPY',
	'CABLE': 'GBPUSD',
	'KIWI': 'NZDUSD',
	'LOONIE': 'USDCAD',
	'THEFUNDS': 'USDCAD',
	'THE FUNDS': 'USDCAD',
	'FUNDS': 'USDCAD',
	'BEAVER': 'USDCAD',
	'SWISSY': 'USDCHF',
	'NINJA': 'USDJPY',
	'BETTY': 'EURRUB',
	'BARNEY': 'USDRUB',
	'BULLION': 'GoldUSD',
	'GOLD': 'GoldUSD',
	'SILVER': 'SilverUSD',
	'DOW JONES': 'U30USD',
	'DJIA': 'US30',
	'NASDAQ': 'US100',
	'FTSE': 'UK100',
	'DAX 30': 'GER30',
	'DAX30': 'GER30',
	'DAX': 'GER30',
	'CAC 40': 'FRA40',
	'CAC40': 'FRA40',
	'CAC': 'FRA40',
	'STOXX 50': 'EUSTX50',
	'STOXX50': 'EUSTX50',
	'STOXX': 'EUSTX50',
	'NIKKEI': 'JPN225',
	'S&amp;P 500': 'US500',
	'S&amp;P500': 'US500',
	'S&amp;P': 'US500',
	'IBEX 35': 'ESP35',
	'IBEX': 'ESP35',
	'OIL': 'USOil'
};

function getSymbolForNickname(nickname) {
	var symbol = symbolNicknames[nickname];
	return symbol;
}

var offlineDescriptions = {
	&quot;EURUSD&quot;: &quot;Euro / US Dollar&quot;,
	&quot;USDJPY&quot;: &quot;US Dollar / Japanese Yen&quot;,
	&quot;GBPUSD&quot;: &quot;British Pound / US Dollar&quot;,
	&quot;USDCAD&quot;: &quot;US Dollar / Canadian Dollar&quot;,
	&quot;USDCHF&quot;: &quot;US Dollar / Swiss Franc&quot;,
	&quot;AUDUSD&quot;: &quot;Australian Dollar / US Dollar&quot;,
	&quot;USOil&quot;: &quot;US Oil&quot;,
	&quot;GoldUSD&quot;: &quot;Gold / US Dollar&quot;,
	&quot;EURJPY&quot;: &quot;Euro / Japanese Yen&quot;,
	&quot;EURCHF&quot;: &quot;Euro / Swiss Franc&quot;,
	&quot;EURCAD&quot;: &quot;Euro / Canadian Dollar&quot;,
	&quot;EURGBP&quot;: &quot;Euro / British Pound&quot;,
	&quot;EURAUD&quot;: &quot;Euro / Australian Dollar&quot;,
	&quot;NZDUSD&quot;: &quot;New Zealand Dollar / US Dollar&quot;,
	&quot;UK100&quot;: &quot;UK 100&quot;,
	&quot;AUS200&quot;: &quot;Australia 200&quot;,
	&quot;JPN225&quot;: &quot;Japan 225&quot;,
	&quot;GER30&quot;: &quot;Germany 30&quot;,
	&quot;ESP35&quot;: &quot;Spain 35&quot;,
	&quot;EUSTX50&quot;: &quot;Euro 50&quot;,
	&quot;FRA40&quot;: &quot;France 40&quot;,
	&quot;ITA40&quot;: &quot;Italy 40&quot;,
	&quot;US100&quot;: &quot;US Tech 100&quot;,
	&quot;US500&quot;: &quot;US SP 500&quot;,
	&quot;US30&quot;: &quot;US 30&quot;,
	&quot;UKOil&quot;: &quot;UK Oil&quot;,
	&quot;SilverUSD&quot;: &quot;Silver / US Dollar&quot;,
	&quot;GoldEUR&quot;: &quot;Gold / Euro&quot;
};
var offlineSymbols = {
	&quot;USOil&quot; : &quot;USOUSD&quot;,
	&quot;GoldUSD&quot;: &quot;XAUUSD&quot;
};

function getDescriptionForSymbolOffline(symbol) {
	var desc = offlineDescriptions[symbol];
	return desc;
}
function getOfflineSymbol(symbol) {
	var sym = offlineSymbols[symbol];
	if(!sym) {
		sym = symbol;
	}
	return sym;
}


/// 	SVGs	 ///

var logo = '&lt;g id=&quot;Logo&quot; stroke=&quot;none&quot; stroke-width=&quot;1&quot; fill=&quot;none&quot; fill-rule=&quot;evenodd&quot; sketch:type=&quot;MSPage&quot;&gt;&lt;g id=&quot;Order-Popup&quot; sketch:type=&quot;MSArtboardGroup&quot; transform=&quot;translate(-191.000000, -70.000000)&quot; fill=&quot;#FFFFFF&quot;&gt;&lt;g id=&quot;USDJPY-Position-Copy-3&quot; sketch:type=&quot;MSLayerGroup&quot; transform=&quot;translate(74.000000, 62.000000)&quot;&gt;&lt;g id=&quot;Trade-Button-Copy&quot; transform=&quot;translate(97.000000, 0.000000)&quot; sketch:type=&quot;MSShapeGroup&quot;&gt;&lt;g id=&quot;TR-Icon-Copy&quot; transform=&quot;translate(20.000000, 8.000000)&quot;&gt;&lt;path d=&quot;M17.5,34 L17.5,34 C26.6126984,34 34,26.6126984 34,17.5 C34,8.38730163 26.6126984,1 17.5,1 C8.38730163,1 1,8.38730163 1,17.5 C1,26.6126984 8.38730163,34 17.5,34 L17.5,34 Z M17.5,35 L17.5,35 C7.83501688,35 0,27.1649831 0,17.5 C0,7.83501688 7.83501688,0 17.5,0 C27.1649831,0 35,7.83501688 35,17.5 C35,27.1649831 27.1649831,35 17.5,35 L17.5,35 Z M9.49878788,17.5848485 L9.49878788,22.8539394 C9.49878788,25.0493939 10.4915152,26.1566667 12.4960606,26.1566667 C13.1451515,26.1566667 13.7369697,26.080303 14.2715152,25.9275758 C14.5960606,25.8321212 14.7106061,25.7175758 14.7106061,25.3930303 L14.7106061,25.3166667 C14.7106061,24.9921212 14.5578788,24.8584848 14.2715152,24.9539394 C13.7369697,25.1066667 13.1451515,25.1830303 12.4769697,25.1830303 C11.1978788,25.1830303 10.5106061,24.5530303 10.5106061,22.8539394 L10.5106061,17.5848485 L13.9278788,17.5848485 C14.2906061,17.5848485 14.3669697,17.470303 14.3669697,17.1457576 L14.3669697,17.0693939 C14.3669697,16.7448485 14.2906061,16.630303 13.9278788,16.630303 L10.5106061,16.630303 L10.5106061,14.4921212 C10.5106061,14.2439394 10.4533333,14.1484848 10.1669697,14.1484848 L10.0715152,14.1484848 C9.82333333,14.1484848 9.7469697,14.2057576 9.68969697,14.4921212 L9.49878788,16.630303 L9.49878788,17.5848485 Z M17.3833333,19.7230303 C17.3833333,18.1766667 17.8987879,17.4130303 19.3687879,17.4130303 C19.6551515,17.4130303 19.9033333,17.4321212 20.1133333,17.470303 C20.4378788,17.5275758 20.5524242,17.4512121 20.5524242,17.0884848 L20.5524242,16.9739394 C20.5524242,16.6493939 20.4951515,16.5730303 20.1324242,16.5157576 C19.8651515,16.4775758 19.6169697,16.4584848 19.3687879,16.4584848 C17.3642424,16.4584848 16.3715152,17.5275758 16.3715152,19.6848485 L16.3715152,25.5266667 C16.3715152,25.8893939 16.4669697,25.9848485 16.829697,25.9848485 L16.9251515,25.9848485 C17.2878788,25.9848485 17.3833333,25.8893939 17.3833333,25.5266667 L17.3833333,19.7230303 Z&quot; id=&quot;Shape&quot;&gt;&lt;/path&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;';

var tradeButtonSvg = &quot;&lt;svg viewBox='-1 -1 18 18' class='tr-embed-trade-btn-logo'&gt;&quot; 
				+ '&lt;g id=&quot;tr-logo&quot; stroke=&quot;none&quot; stroke-width=&quot;1&quot; fill=&quot;none&quot; fill-rule=&quot;evenodd&quot; sketch:type=&quot;MSPage&quot;&gt;&lt;g id=&quot;Trade-Buttons&quot; sketch:type=&quot;MSArtboardGroup&quot; transform=&quot;translate(-70.000000, -77.000000)&quot;&gt;&lt;g id=&quot;Tr-Logo&quot; sketch:type=&quot;MSLayerGroup&quot; transform=&quot;translate(70.000000, 77.000000)&quot;&gt;&lt;circle id=&quot;Oval-1-Copy-2&quot; stroke=&quot;#FFFFFF&quot; sketch:type=&quot;MSShapeGroup&quot; cx=&quot;8&quot; cy=&quot;8&quot; r=&quot;8&quot;&gt;&lt;/circle&gt;&lt;path d=&quot;M5.275,7 L5.275,9.26 C5.275,10.49 5.875,11.1 7.075,11.1 C7.345,11.1 7.615,11.07 7.885,11.02 C8.215,10.95 8.295,10.85 8.295,10.52 L8.295,10.4 C8.295,10.05 8.215,9.98 7.885,10.05 C7.645,10.11 7.375,10.14 7.075,10.14 C6.555,10.14 6.295,9.85 6.295,9.27 L6.295,7 L7.695,7 C8.025,7 8.115,6.93 8.115,6.58 L8.115,6.46 C8.115,6.11 8.025,6.04 7.695,6.04 L6.295,6.04 L6.295,5.1 C6.295,4.81 6.225,4.74 5.935,4.74 L5.805,4.74 C5.515,4.74 5.435,4.81 5.395,5.1 L5.275,6.04 L5.275,7 Z M10.065,7.77 C10.065,7.16 10.255,6.89 10.925,6.89 C11.005,6.89 11.075,6.89 11.125,6.9 C11.475,6.95 11.545,6.88 11.545,6.55 L11.545,6.41 C11.545,6.06 11.455,5.98 11.125,5.94 C11.075,5.93 11.005,5.93 10.925,5.93 C9.665,5.93 9.035,6.52 9.035,7.7 L9.035,10.55 C9.035,10.91 9.125,11 9.485,11 L9.615,11 C9.975,11 10.065,10.91 10.065,10.55 L10.065,7.77 Z&quot; id=&quot;tr-copy-4&quot; fill=&quot;#FFFFFF&quot; sketch:type=&quot;MSShapeGroup&quot;&gt;&lt;/path&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;'
				+ &quot;&lt;/svg&gt;&quot;;

var dashboardLogo = &quot;&lt;svg viewBox='0 0 25 25' class='tr-embed-dashboard-logo'&gt;&quot;
			+ '&lt;g id=&quot;logo&quot;&gt;&lt;path d=&quot;M12.5,24 L12.5,24 C18.8512746,24 24,18.8512746 24,12.5 C24,6.14872538 18.8512746,1 12.5,1 C6.14872538,1 1,6.14872538 1,12.5 C1,18.8512746 6.14872538,24 12.5,24 L12.5,24 Z M12.5,25 L12.5,25 C5.59644063,25 0,19.4035594 0,12.5 C0,5.59644063 5.59644063,0 12.5,0 C19.4035594,0 25,5.59644063 25,12.5 C25,19.4035594 19.4035594,25 12.5,25 L12.5,25 Z M6.26065823,12.8623418 L6.26065823,16.4794304 C6.26065823,18.1598101 7.05812658,19 8.65306329,19 C9.09451899,19 9.50749367,18.9572785 9.89198734,18.8575949 C10.248,18.7579114 10.333443,18.6297468 10.333443,18.3449367 L10.333443,18.2167722 C10.333443,17.8607595 10.2337595,17.7753165 9.90622785,17.846519 C9.5644557,17.9462025 9.13724051,17.9889241 8.63882278,17.9889241 C7.78439241,17.9889241 7.3286962,17.5759494 7.3286962,16.4794304 L7.3286962,12.8623418 L9.63565823,12.8623418 C9.99167089,12.8623418 10.0771139,12.7768987 10.0771139,12.4208861 L10.0771139,12.2927215 C10.0771139,11.9367089 9.99167089,11.8512658 9.63565823,11.8512658 L7.3286962,11.8512658 L7.3286962,10.3844937 C7.3286962,10.085443 7.24325316,10 6.94420253,10 L6.84451899,10 C6.51698734,10 6.4315443,10.085443 6.4173038,10.3844937 L6.26065823,11.8512658 L6.26065823,12.8623418 Z M12.498,14.2294304 C12.498,13.2041139 12.8397722,12.7199367 13.8650886,12.7199367 C13.9932532,12.7199367 14.1356582,12.7341772 14.3065443,12.7484177 C14.662557,12.8053797 14.748,12.7341772 14.748,12.3781646 L14.748,12.2357595 C14.748,11.8797468 14.6767975,11.7800633 14.3207848,11.7373418 C14.1926203,11.7231013 14.0359747,11.7088608 13.8650886,11.7088608 C12.2416709,11.7088608 11.429962,12.5348101 11.429962,14.1724684 L11.429962,18.4161392 C11.429962,18.8006329 11.5296456,18.8718354 11.8856582,18.8718354 L12.0423038,18.8718354 C12.4267975,18.8718354 12.498,18.8006329 12.498,18.4161392 L12.498,14.2294304 Z&quot; id=&quot;Shape&quot;&gt;&lt;/path&gt;&lt;/g&gt;' +
                + &quot;&lt;/svg&gt;&quot;;

    var posOrdIcon = &quot;&lt;svg viewBox='0 0 12 10' class='tr-embed-pos-ord-logo'&gt;&quot; 
    			+ '&lt;g id=&quot;popout&quot;&gt;&lt;path class=&quot;path1&quot; d=&quot;M10.267767,1 L6.5,4.76776695 L7.20710678,5.47487373 L11,1.68198052 L11,5 L12,5 L12,0 L11,0 L11,0.391242789 L11,0 L7,0 L7,1 L10.267767,1 Z M0,1 L1,1 L1,10 L0,10 L0,1 Z M1,9 L11,9 L11,10 L1,10 L1,9 Z M10,6 L11,6 L11,9 L10,9 L10,6 Z M1,1 L6,1 L6,2 L1,2 L1,1 Z&quot; id=&quot;Rectangle-51&quot;&gt;&lt;/path&gt;&lt;/g&gt;'
			+ &quot;&lt;/svg&gt;&quot;;

    var tradeIcon = &quot;&lt;svg viewBox='0 0 9 11' class='tr-embed-trade-logo'&gt;&quot; 
    			+ '&lt;g id=&quot;new_trade&quot;&gt;&lt;path d=&quot;M0,1 L0,1 L1,0 L1,11 L0,10 L9,10 L8,11 L8,3.11254883 L8.27999548,3.8065182 L5.27999548,0.693969373 L6,1 L0,1 Z M0,0 L6,0 L9,3.11254883 L9,11 L0,11 L0,0 L0,0 Z M4,3 L5,3 L5,8 L4,8 L4,3 Z M2,5 L4,5 L4,6 L2,6 L2,5 Z M5,5 L7,5 L7,6 L5,6 L5,5 Z&quot; id=&quot;Shape&quot;&gt;&lt;/path&gt;&lt;/g&gt;'
    			+ &quot;&lt;/svg&gt;&quot;;

var tradableVector = &quot;&lt;svg viewBox='0 0 1061 218' class='tr-embed-dashboard-logo'&gt;&quot; 
			+ '&lt;g id=&quot;tradable_vector&quot;&gt;&lt;g transform=&quot;matrix(1,0,0,1,-87.0428,-269.811)&quot;&gt;&lt;g transform=&quot;matrix(0.764038,0,0,0.764038,-320.83,29.9679)&quot;&gt;&lt;path d=&quot;M533.839,397.915L533.839,528.315C533.839,574.315 554.639,597.515 596.639,597.515C610.239,597.515 622.639,595.915 633.839,592.715C640.639,590.715 643.039,588.315 643.039,581.515L643.039,579.915C643.039,573.115 639.839,570.315 633.839,572.315C622.639,575.515 610.239,577.115 596.239,577.115C569.439,577.115 555.039,563.915 555.039,528.315L555.039,417.915L626.639,417.915C634.239,417.915 635.839,415.515 635.839,408.715L635.839,407.115C635.839,400.315 634.239,397.915 626.639,397.915L555.039,397.915L555.039,353.115C555.039,347.915 553.839,345.915 547.839,345.915L545.839,345.915C540.639,345.915 539.039,347.115 537.839,353.115L533.839,397.915Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;path d=&quot;M699.039,462.715C699.039,430.315 709.839,414.315 740.639,414.315C746.639,414.315 751.839,414.715 756.239,415.515C763.039,416.715 765.439,415.115 765.439,407.515L765.439,405.115C765.439,398.315 764.239,396.715 756.639,395.515C751.039,394.715 745.839,394.315 740.639,394.315C698.639,394.315 677.839,416.715 677.839,461.915L677.839,584.315C677.839,591.915 679.839,593.915 687.439,593.915L689.439,593.915C697.039,593.915 699.039,591.915 699.039,584.315L699.039,462.715Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;path d=&quot;M931.439,454.315C931.439,414.315 905.039,394.315 852.639,394.315C833.839,394.315 818.239,395.915 805.839,398.715C799.039,400.315 797.039,402.315 797.039,409.115L797.039,411.915C797.039,419.515 799.039,421.115 805.839,419.115C819.039,415.515 835.039,413.515 853.839,413.515C890.639,413.515 910.239,424.315 910.239,454.315L910.239,481.915L860.239,481.915C804.639,481.915 778.639,498.715 778.639,539.115C778.639,579.515 809.039,597.515 849.039,597.515C906.239,597.515 931.439,579.915 931.439,534.715L931.439,454.315ZM910.239,533.915C910.239,568.715 891.839,578.315 849.039,578.315C816.239,578.315 799.839,565.115 799.839,539.115C799.839,509.915 818.239,499.515 861.039,499.515L910.239,499.515L910.239,533.915Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;path d=&quot;M1143.04,323.515C1143.04,315.915 1141.04,313.915 1133.44,313.915L1131.04,313.915C1123.44,313.915 1121.44,315.915 1121.44,323.515L1121.44,426.315C1111.44,405.115 1089.44,394.315 1056.24,394.315C997.039,394.315 973.839,423.515 973.839,476.715L973.839,515.515C973.839,568.715 998.639,597.515 1058.24,597.515C1114.64,597.515 1143.04,570.315 1143.04,515.515L1143.04,323.515ZM995.039,476.315C995.039,433.515 1010.24,414.315 1058.24,414.315C1106.24,414.315 1121.44,433.515 1121.44,476.315L1121.44,515.515C1121.44,558.315 1106.24,577.515 1058.24,577.515C1010.24,577.515 995.039,558.315 995.039,515.515L995.039,476.315Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;path d=&quot;M1334.24,454.315C1334.24,414.315 1307.84,394.315 1255.44,394.315C1236.64,394.315 1221.04,395.915 1208.64,398.715C1201.84,400.315 1199.84,402.315 1199.84,409.115L1199.84,411.915C1199.84,419.515 1201.84,421.115 1208.64,419.115C1221.84,415.515 1237.84,413.515 1256.64,413.515C1293.44,413.515 1313.04,424.315 1313.04,454.315L1313.04,481.915L1263.04,481.915C1207.44,481.915 1181.44,498.715 1181.44,539.115C1181.44,579.515 1211.84,597.515 1251.84,597.515C1309.04,597.515 1334.24,579.915 1334.24,534.715L1334.24,454.315ZM1313.04,533.915C1313.04,568.715 1294.64,578.315 1251.84,578.315C1219.04,578.315 1202.64,565.115 1202.64,539.115C1202.64,509.915 1221.04,499.515 1263.84,499.515L1313.04,499.515L1313.04,533.915Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;path d=&quot;M1383.84,515.515C1383.84,570.315 1411.84,597.515 1468.24,597.515C1528.64,597.515 1553.04,568.715 1553.04,515.515L1553.04,476.715C1553.04,423.515 1529.44,394.315 1470.64,394.315C1437.04,394.315 1415.04,405.115 1405.04,426.315L1405.04,323.515C1405.04,315.915 1403.04,313.915 1395.44,313.915L1393.44,313.915C1385.84,313.915 1383.84,315.915 1383.84,323.515L1383.84,515.515ZM1531.44,515.515C1531.44,558.315 1516.24,577.515 1468.24,577.515C1420.24,577.515 1405.04,558.315 1405.04,515.515L1405.04,476.315C1405.04,433.515 1420.24,414.315 1468.24,414.315C1516.24,414.315 1531.44,433.515 1531.44,476.315L1531.44,515.515Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;path d=&quot;M1600.64,546.315C1600.64,581.115 1617.44,595.515 1641.84,595.515C1644.64,595.515 1646.64,595.515 1648.24,595.115C1655.84,593.915 1657.44,591.915 1657.44,585.115L1657.44,583.515C1657.44,576.715 1655.84,575.515 1648.24,575.515L1643.44,575.515C1629.04,575.515 1621.84,565.115 1621.84,543.915L1621.84,323.515C1621.84,315.915 1619.84,313.915 1612.24,313.915L1610.24,313.915C1602.64,313.915 1600.64,315.915 1600.64,323.515L1600.64,546.315Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;path d=&quot;M1844.64,471.515C1844.64,420.315 1815.84,394.315 1765.04,394.315C1711.04,394.315 1683.84,421.515 1683.84,476.315L1683.84,515.515C1683.84,573.515 1711.84,597.515 1771.44,597.515C1793.44,597.515 1812.64,594.715 1829.04,588.715C1836.64,585.915 1837.84,585.115 1837.84,578.315L1837.84,575.915C1837.84,568.315 1835.44,566.715 1829.04,568.715C1811.44,574.715 1792.24,577.515 1771.04,577.515C1724.24,577.515 1705.04,561.515 1705.04,518.315L1705.04,504.315L1833.04,504.315C1840.64,504.315 1842.24,502.315 1843.44,494.715C1844.24,487.515 1844.64,479.915 1844.64,471.515ZM1705.04,469.515C1705.04,432.315 1725.04,413.515 1764.64,413.515C1804.24,413.515 1824.24,432.315 1824.24,469.515L1824.24,485.515L1705.04,485.515L1705.04,469.515Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;/g&gt;&lt;g transform=&quot;matrix(0.764038,0,0,0.764038,-317.125,-75.0529)&quot;&gt;&lt;path d=&quot;M1870.18,712.266C1870.18,718.733 1872.45,724.333 1877.05,728.933C1881.65,733.533 1887.18,735.799 1893.65,735.799C1900.25,735.799 1905.78,733.533 1910.38,728.933C1914.98,724.333 1917.25,718.733 1917.25,712.266C1917.25,705.733 1914.98,700.199 1910.38,695.599C1905.78,690.999 1900.25,688.666 1893.65,688.666C1887.18,688.666 1881.65,690.999 1877.05,695.599C1872.45,700.199 1870.18,705.733 1870.18,712.266ZM1893.65,732.599C1888.12,732.599 1883.32,730.599 1879.32,726.666C1875.38,722.666 1873.38,717.866 1873.38,712.266C1873.38,706.666 1875.38,701.866 1879.32,697.866C1883.32,693.866 1888.12,691.866 1893.65,691.866C1899.32,691.866 1904.12,693.866 1908.05,697.866C1912.05,701.799 1914.05,706.599 1914.05,712.266C1914.05,717.866 1912.05,722.666 1908.05,726.666C1904.12,730.599 1899.32,732.599 1893.65,732.599ZM1898.38,723.399C1899.18,724.799 1899.78,725.199 1901.45,725.199L1901.98,725.199C1903.65,725.199 1903.85,724.933 1903.05,723.399L1897.98,714.333C1901.72,713.466 1903.58,710.999 1903.58,706.933C1903.58,701.866 1900.65,699.333 1894.78,699.333L1891.58,699.333C1886.85,699.333 1884.92,701.399 1884.92,705.999L1884.92,723.399C1884.92,724.933 1885.32,725.199 1886.72,725.199L1887.32,725.199C1888.85,725.199 1889.12,724.933 1889.12,723.399L1889.12,714.733L1893.72,714.733L1898.38,723.399ZM1894.72,703.133C1897.98,703.133 1899.25,704.333 1899.25,707.066C1899.25,709.933 1897.98,710.999 1894.32,710.999L1889.12,710.999L1889.12,705.933C1889.12,704.066 1890.05,703.133 1891.92,703.133L1894.72,703.133Z&quot; style=&quot;fill-rule:nonzero;&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;'
			+ &quot;&lt;/svg&gt;&quot;;

var closeButton = '&lt;svg width=&quot;15px&quot; height=&quot;15px&quot; viewBox=&quot;0 0 15 15&quot; class=&quot;tr-embed-close-icon&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xmlns:sketch=&quot;http://www.bohemiancoding.com/sketch/ns&quot;&gt;&lt;g id=&quot;Page-1&quot; stroke=&quot;none&quot; stroke-width=&quot;1&quot; fill-rule=&quot;evenodd&quot; sketch:type=&quot;MSPage&quot;&gt;&lt;g id=&quot;Positions-Widget&quot; sketch:type=&quot;MSArtboardGroup&quot; transform=&quot;translate(-253.000000, -340.000000)&quot; &gt;&lt;g id=&quot;Responsive-Copy-4&quot; sketch:type=&quot;MSLayerGroup&quot; transform=&quot;translate(45.000000, 260.000000)&quot;&gt;&lt;g id=&quot;Instruments&quot; transform=&quot;translate(1.000000, 27.000000)&quot; sketch:type=&quot;MSShapeGroup&quot;&gt;&lt;g id=&quot;Row-Copy&quot; transform=&quot;translate(4.000000, 46.000000)&quot;&gt;&lt;g id=&quot;Rectangle-898-+-Trade&quot; transform=&quot;translate(23.000000, 3.000000)&quot;&gt;&lt;g id=&quot;Order-Icon-Copy-2&quot; transform=&quot;translate(180.000000, 4.000000)&quot;&gt;&lt;path d=&quot;M7.5,6.79289322 L5.37867966,4.67157288 L4.67157288,5.37867966 L6.79289322,7.5 L4.67157288,9.62132034 L5.37867966,10.3284271 L7.5,8.20710678 L9.62132034,10.3284271 L10.3284271,9.62132034 L8.20710678,7.5 L10.3284271,5.37867966 L9.62132034,4.67157288 L7.5,6.79289322 Z M7.5,15 C3.35786438,15 0,11.6421356 0,7.5 C0,3.35786438 3.35786438,-8.8817842e-16 7.5,-8.8817842e-16 C11.6421356,-8.8817842e-16 15,3.35786438 15,7.5 C15,11.6421356 11.6421356,15 7.5,15 Z M7.5,14 C11.0898509,14 14,11.0898509 14,7.5 C14,3.91014913 11.0898509,1 7.5,1 C3.91014913,1 1,3.91014913 1,7.5 C1,11.0898509 3.91014913,14 7.5,14 Z&quot; id=&quot;Shape&quot;&gt;&lt;/path&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;';

var checkAnimated = '&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 100 100&quot; preserveAspectRatio=&quot;xMidYMid&quot;&gt;&lt;g&gt;&lt;circle id=&quot;pulseCircleLight&quot; cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;40&quot; stroke=&quot;#26d1c1&quot; fill=&quot;none&quot; stroke-width=&quot;1.5&quot; opacity=&quot;1&quot; stroke-linecap=&quot;round&quot;&gt;&lt;/circle&gt;&lt;circle id=&quot;pulseCircleDark&quot; cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;40&quot; stroke=&quot;#108993&quot; fill=&quot;none&quot; stroke-width=&quot;1.5&quot; opacity=&quot;1&quot; stroke-linecap=&quot;round&quot;&gt;&lt;/circle&gt;&lt;path id=&quot;checkmark&quot; stroke-width=&quot;1.5&quot; fill=&quot;none&quot; fill-rule=&quot;evenodd&quot; d=&quot;M37,49 L47,59 L65,41&quot; stroke=&quot;#26D1C1&quot; stroke-dasharray=&quot;40,40&quot; stroke-dashoffset=&quot;40&quot;&gt;&lt;/path&gt;&lt;g id=&quot;crossmark&quot; stroke-width=&quot;1.5&quot; transform=&quot;translate(50.000000, 50.000000) rotate(-315.000000) translate(-50.000000, -50.000000) translate(37.000000, 37.000000)&quot; stroke=&quot;#D5005D&quot; stroke-linecap=&quot;square&quot;&gt;&lt;path class=&quot;crossmark-line&quot; id=&quot;line1&quot; stroke-dashoffset=&quot;26&quot; stroke-dasharray=&quot;25,28&quot; d=&quot;M14,27 L14,1&quot; &gt;&lt;/path&gt;&lt;path class=&quot;crossmark-line&quot; id=&quot;line2&quot; stroke-dashoffset=&quot;26&quot; stroke-dasharray=&quot;25,28&quot; d=&quot;M1,14 L27,14&quot; &gt;&lt;/path&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;';

var pulseCircleLight, pulseCircleDark, checkmark, crossmarkLines, pulseLight, pulseDark;
function initAnimation() {
	// Animation elements
	pulseCircleLight = document.getElementById(&quot;pulseCircleLight&quot;),
	pulseCircleDark = document.getElementById(&quot;pulseCircleDark&quot;),
	checkmark = document.getElementById(&quot;checkmark&quot;),
	crossmarkLines = document.getElementsByClassName(&quot;crossmark-line&quot;);

	// Pulse animations
	pulseLight = new TimelineLite()
	.fromTo(pulseCircleLight, 2, {attr:{r: 0}}, {attr:{r: 40}}, 'start')
	.fromTo(pulseCircleLight, 1.2, {attr:{opacity: 1}}, {attr:{opacity: 0}}, 'start+=0.8')
	.call(function(){
		pulseLight.seek(0);// Repeat timeline when at the end
	}).pause(); // Pause and wait for initialization

	pulseDark = new TimelineLite()
	.fromTo(pulseCircleDark,  2, {attr:{r: 0}}, {attr:{r: 40}}, 'start')
	.fromTo(pulseCircleDark,  1.2, {attr:{opacity: 1}}, {attr:{opacity: 0}}, 'start+=0.8')
	.call(function(){
		pulseDark.seek(0); // Repeat timeline when at the end
	})
	.delay(1) // Delay by 1 second to create overlap
	.pause(); // Pause and wait for initialization

	// onReady
	pulseLight.play();
	pulseDark.play();
}

    // Method to prepare animation elements for end state
    function endState(color){
        // Hide status symbols
        TweenLite.set(checkmark, {attr:{'stroke-dashoffset': 40}});
        TweenLite.set(crossmarkLines, {attr:{'stroke-dashoffset': 26}});

        // Stop pulse animations at their current state
        pulseLight.pause();
        pulseDark.pause();

        // Apply final states to circles
        TweenLite.set(pulseCircleLight, {attr:{stroke: color}});
        TweenLite.to(pulseCircleLight, 0.15, {attr:{r:30, opacity:1}});
        TweenLite.to(pulseCircleDark, 0.15, {attr:{ opacity:0}});
    }

// Methods to stop animation and set success/failure state
function setConfirmationAnimationCheck() {
        endState(&quot;#26d1c1&quot;);
        TweenLite.to(checkmark, 0.15, {attr:{'stroke-dashoffset': 0}});
}

// Hook up buttons to showcase functionality
function setConfirmationAnimationError() {
        endState(&quot;#D5005D&quot;);
        TweenLite.to(crossmarkLines, 0.15, {attr:{'stroke-dashoffset': 0}});
}

// Method to reset back to animating/initial state
    function resetConfirmationAnimationState(){
        // Hide status symbols
        TweenLite.set(checkmark, {attr:{'stroke-dashoffset': 40}});
        TweenLite.set(crossmarkLines, {attr:{'stroke-dashoffset': 26}});

        // Reset light pulse circle to original color
        TweenLite.set(pulseCircleLight, {attr:{stroke:'#26d1c1'}});

        pulseLight.play();
        pulseDark.play();
    }

})(trEmbJQ);</code></pre>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p>Documentation generated with <a href="https://github.com/FGRibreau/doxx">Doxx </a> created by <a href="https://twitter.com/FGRibreau" data-show-count="false" class="twitter-follow-button">Francois-Guillaume Ribreau </a></p>
        <p>Doxx is sponsored by <a href="http://bringr.net/?btt" title="Outil d'analyse des rseaux sociaux" class="bringr">Bringr </a> and <a href="https://redsmin.com/?btt" title="Full Redis GUI" class="redsmin">Redsmin</a></p>
        <p>Theme borrowed from Twitter Bootstrap</p>
      </div>
    </footer>
    <script src="http://platform.twitter.com/widgets.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    <script src="http://leaverou.github.com/prefixfree/prefixfree.js"></script>
    <script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-transition.js"></script>
    <script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-scrollspy.js"></script>
    <script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-dropdown.js"></script>
    <script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-collapse.js"></script>
    <script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-affix.js"></script>
    <script>
      /**
       * Prism: Lightweight, robust, elegant syntax highlighting
       * MIT license http://www.opensource.org/licenses/mit-license.php/
       * @author Lea Verou http://lea.verou.me
       */(function(){var e=/\blang(?:uage)?-(?!\*)(\w+)\b/i,t=self.Prism={util:{type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},clone:function(e){var n=t.util.type(e);switch(n){case"Object":var r={};for(var i in e)e.hasOwnProperty(i)&&(r[i]=t.util.clone(e[i]));return r;case"Array":return e.slice()}return e}},languages:{extend:function(e,n){var r=t.util.clone(t.languages[e]);for(var i in n)r[i]=n[i];return r},insertBefore:function(e,n,r,i){i=i||t.languages;var s=i[e],o={};for(var u in s)if(s.hasOwnProperty(u)){if(u==n)for(var a in r)r.hasOwnProperty(a)&&(o[a]=r[a]);o[u]=s[u]}return i[e]=o},DFS:function(e,n){for(var r in e){n.call(e,r,e[r]);t.util.type(e)==="Object"&&t.languages.DFS(e[r],n)}}},highlightAll:function(e,n){var r=document.querySelectorAll('code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code');for(var i=0,s;s=r[i++];)t.highlightElement(s,e===!0,n)},highlightElement:function(r,i,s){var o,u,a=r;while(a&&!e.test(a.className))a=a.parentNode;if(a){o=(a.className.match(e)||[,""])[1];u=t.languages[o]}if(!u)return;r.className=r.className.replace(e,"").replace(/\s+/g," ")+" language-"+o;a=r.parentNode;/pre/i.test(a.nodeName)&&(a.className=a.className.replace(e,"").replace(/\s+/g," ")+" language-"+o);var f=r.textContent;if(!f)return;f=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g," ");var l={element:r,language:o,grammar:u,code:f};t.hooks.run("before-highlight",l);if(i&&self.Worker){var c=new Worker(t.filename);c.onmessage=function(e){l.highlightedCode=n.stringify(JSON.parse(e.data));l.element.innerHTML=l.highlightedCode;s&&s.call(l.element);t.hooks.run("after-highlight",l)};c.postMessage(JSON.stringify({language:l.language,code:l.code}))}else{l.highlightedCode=t.highlight(l.code,l.grammar);l.element.innerHTML=l.highlightedCode;s&&s.call(r);t.hooks.run("after-highlight",l)}},highlight:function(e,r){return n.stringify(t.tokenize(e,r))},tokenize:function(e,n){var r=t.Token,i=[e],s=n.rest;if(s){for(var o in s)n[o]=s[o];delete n.rest}e:for(var o in n){if(!n.hasOwnProperty(o)||!n[o])continue;var u=n[o],a=u.inside,f=!!u.lookbehind||0;u=u.pattern||u;for(var l=0;l<i.length;l++){var c=i[l];if(i.length>e.length)break e;if(c instanceof r)continue;u.lastIndex=0;var h=u.exec(c);if(h){f&&(f=h[1].length);var p=h.index-1+f,h=h[0].slice(f),d=h.length,v=p+d,m=c.slice(0,p+1),g=c.slice(v+1),y=[l,1];m&&y.push(m);var b=new r(o,a?t.tokenize(h,a):h);y.push(b);g&&y.push(g);Array.prototype.splice.apply(i,y)}}}return i},hooks:{all:{},add:function(e,n){var r=t.hooks.all;r[e]=r[e]||[];r[e].push(n)},run:function(e,n){var r=t.hooks.all[e];if(!r||!r.length)return;for(var i=0,s;s=r[i++];)s(n)}}},n=t.Token=function(e,t){this.type=e;this.content=t};n.stringify=function(e){if(typeof e=="string")return e;if(Object.prototype.toString.call(e)=="[object Array]"){for(var r=0;r<e.length;r++)e[r]=n.stringify(e[r]);return e.join("")}var i={type:e.type,content:n.stringify(e.content),tag:"span",classes:["token",e.type],attributes:{}};i.type=="comment"&&(i.attributes.spellcheck="true");t.hooks.run("wrap",i);var s="";for(var o in i.attributes)s+=o+'="'+(i.attributes[o]||"")+'"';return"<"+i.tag+' class="'+i.classes.join(" ")+'" '+s+">"+i.content+"</"+i.tag+">"};if(!self.document){self.addEventListener("message",function(e){var n=JSON.parse(e.data),r=n.language,i=n.code;self.postMessage(JSON.stringify(t.tokenize(i,t.languages[r])));self.close()},!1);return}var r=document.getElementsByTagName("script");r=r[r.length-1];if(r){t.filename=r.src;document.addEventListener&&!r.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",t.highlightAll)}})();;
      Prism.languages.markup={comment:/&lt;!--[\w\W]*?--(&gt;|&gt;)/g,prolog:/&lt;\?.+?\?&gt;/,doctype:/&lt;!DOCTYPE.+?&gt;/,cdata:/&lt;!\[CDATA\[[\w\W]+?]]&gt;/i,tag:{pattern:/&lt;\/?[\w:-]+\s*(?:\s+[\w:-]+(?:=(?:("|')(\\?[\w\W])*?\1|\w+))?\s*)*\/?&gt;/gi,inside:{tag:{pattern:/^&lt;\/?[\w:-]+/i,inside:{punctuation:/^&lt;\/?/,namespace:/^[\w-]+?:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/gi,inside:{punctuation:/=|&gt;|"/g}},punctuation:/\/?&gt;/g,"attr-name":{pattern:/[\w:-]+/g,inside:{namespace:/^[\w-]+?:/}}}},entity:/&amp;#?[\da-z]{1,8};/gi};Prism.hooks.add("wrap",function(e){e.type==="entity"&&(e.attributes.title=e.content.replace(/&amp;/,"&"))});;
      Prism.languages.css={comment:/\/\*[\w\W]*?\*\//g,atrule:/@[\w-]+?(\s+[^;{]+)?(?=\s*{|\s*;)/gi,url:/url\((["']?).*?\1\)/gi,selector:/[^\{\}\s][^\{\}]*(?=\s*\{)/g,property:/(\b|\B)[a-z-]+(?=\s*:)/ig,string:/("|')(\\?.)*?\1/g,important:/\B!important\b/gi,ignore:/&(lt|gt|amp);/gi,punctuation:/[\{\};:]/g};Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{style:{pattern:/(&lt;|<)style[\w\W]*?(>|&gt;)[\w\W]*?(&lt;|<)\/style(>|&gt;)/ig,inside:{tag:{pattern:/(&lt;|<)style[\w\W]*?(>|&gt;)|(&lt;|<)\/style(>|&gt;)/ig,inside:Prism.languages.markup.tag.inside},rest:Prism.languages.css}}});;
      Prism.languages.clike={comment:{pattern:/(^|[^\\])(\/\*[\w\W]*?\*\/|\/\/.*?(\r?\n|$))/g,lookbehind:!0},string:/("|')(\\?.)*?\1/g,keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|catch|finally|null|break|continue)\b/g,"boolean":/\b(true|false)\b/g,number:/\b-?(0x)?\d*\.?[\da-f]+\b/g,operator:/[-+]{1,2}|!|=?&lt;|=?&gt;|={1,2}|(&amp;){1,2}|\|?\||\?|\*|\//g,ignore:/&(lt|gt|amp);/gi,punctuation:/[{}[\];(),.:]/g};;
      Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(var|let|if|else|while|do|for|return|in|instanceof|function|new|with|typeof|try|catch|finally|null|break|continue)\b/g,number:/\b(-?(0x)?\d*\.?[\da-f]+|NaN|-?Infinity)\b/g});Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/g,lookbehind:!0}});Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(&lt;|<)script[\w\W]*?(>|&gt;)[\w\W]*?(&lt;|<)\/script(>|&gt;)/ig,inside:{tag:{pattern:/(&lt;|<)script[\w\W]*?(>|&gt;)|(&lt;|<)\/script(>|&gt;)/ig,inside:Prism.languages.markup.tag.inside},rest:Prism.languages.javascript}}});;
      
    </script>
    <!-- App js-->
    <script>
      $(function(){
        var $window = $(window);
        $('.scrollspy .nav').affix({
          offset: {
            top: function () { return $window.width() <= 980 ? 480 : 400 }
          , bottom: 50
          }
        });
      })
    </script>
  </body>
</html>